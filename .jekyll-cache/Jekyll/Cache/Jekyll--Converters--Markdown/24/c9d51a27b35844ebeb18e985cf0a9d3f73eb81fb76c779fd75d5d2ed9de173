I"ÀZ<p><img src="/attachments/201802/nodejs.jpeg" alt="" />
å› ä¸ºé¡¹ç›®çš„åŸå› ï¼Œæœ€è¿‘ç»å¸¸ä½¿ç”¨node.jsæ­RESTfulæ¥å£ã€‚<br />
æ€§èƒ½è¿˜æ˜¯å¾ˆä¸é”™å•¦ï¼Œæ„Ÿè§‰æ¯”Spring Bootä¹‹ç±»çš„è¦å¿«ã€‚è€Œä¸”åœ¨ä¸é”™çš„æ€§èƒ½ä¹‹å¤–ï¼Œåªè¦ç¨‹åºç»“æ„ç»„ç»‡å¥½ï¼Œåˆ«è®©å¤ªå¤šçš„å›è°ƒæŠŠç¨‹åºç»“æ„æä¹±ï¼Œæ•´ä½“å¼€å‘æ•ˆç‡æ¯”Javaå¿«çš„å°±å¤ªå¤šäº†ã€‚</p>

<p>å¦‚æœæƒ³è¿›ä¸€æ­¥æé«˜æ•ˆç‡ï¼Œä½¿ç”¨c++æ¥ä¼˜åŒ–éƒ¨åˆ†æ¨¡å—æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚å°¤å…¶å¯è´µçš„æ˜¯nodejså¯¹äºåŒc++çš„æ··åˆç¼–ç¨‹æ”¯æŒçš„å¾ˆå¥½ï¼Œä¸ªäººæ„Ÿè§‰è·Ÿå†™Pythonçš„æ‰©å±•æ¨¡å—å¤„äºåŒæ ·çš„æ˜“ç”¨æ°´å¹³ã€‚</p>

<p>æˆ‘ä»¬ä»Hello Worldå¼€å§‹ï¼š<br />
é¦–å…ˆè¦æœ‰ä¸€ä¸ªç©ºç™½çš„å·¥ä½œç›®å½•ï¼Œåœ¨å…¶ä¸­å»ºç«‹ä¸€ä¸ªnodeåŒ…ç®¡ç†æ–‡ä»¶package.jsonï¼Œå†…å®¹ä¸ºï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test-cpp-module</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.1.0</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">private</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">gypfile</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></div></div>
<p>éšååœ¨ç›®å½•ä¸­æ‰§è¡Œå‘½ä»¤ï¼š<code class="language-plaintext highlighter-rouge">npm install node-addon-api --save</code>å®‰è£…nodejsæ‰©å±•æ¨¡å—çš„å¼€å‘æ”¯æŒåŒ…ã€‚è¿™é‡Œå‡è®¾ä½ å·²ç»å®‰è£…é…ç½®å¥½äº†nodejså’Œç›¸åº”çš„npmåŒ…ç®¡ç†å·¥å…·ï¼Œè¿˜æœ‰xcodeçš„ç›¸å…³å‘½ä»¤è¡Œç¼–è¯‘å·¥å…·ã€‚æˆ‘ä»¬ä¸é‡å¤è¿™äº›åŸºæœ¬å·¥å…·çš„å®‰è£…é…ç½®ï¼Œéœ€è¦çš„è¯è¯·å‚è€ƒå®˜ç½‘ç›¸å…³æ–‡æ¡£ã€‚<br />
ä¸Šé¢å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œæˆ‘ä»¬å°±å®Œæˆäº†åŸºæœ¬å¼€å‘ç¯å¢ƒçš„é…ç½®ã€‚</p>

<p>c++çš„æ¨¡å—ç”±binding.gypæ–‡ä»¶æè¿°ï¼Œå¹¶å®Œæˆè‡ªåŠ¨ç¼–è¯‘çš„ç›¸å…³é…ç½®å·¥ä½œï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªbinding.gypæ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">targets</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="dl">"</span><span class="s2">target_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">democpp</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">sources</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">democpp.cc</span><span class="dl">"</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">include_dirs</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">&lt;!@(node -p </span><span class="se">\"</span><span class="s2">require('node-addon-api').include</span><span class="se">\"</span><span class="s2">)</span><span class="dl">"</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">dependencies</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">&lt;!(node -p </span><span class="se">\"</span><span class="s2">require('node-addon-api').gyp</span><span class="se">\"</span><span class="s2">)</span><span class="dl">"</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">cflags!</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">-fno-exceptions</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">cflags_cc!</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">-fno-exceptions</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">defines</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">NAPI_CPP_EXCEPTIONS</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">xcode_settings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">GCC_ENABLE_CPP_EXCEPTIONS</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">YES</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li>æ–‡ä»¶ä¸­é¦–å…ˆä½¿ç”¨target_nameæŒ‡å®šäº†ç¼–è¯‘ä¹‹åæ¨¡å—çš„åç§°ã€‚</li>
  <li>sourcesæŒ‡æ˜c++çš„æºæ–‡ä»¶ï¼Œå¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶ï¼Œéœ€è¦ç”¨é€—å·éš”å¼€ï¼Œæ”¾åˆ°åŒä¸€ä¸ªæ•°ç»„ä¸­ã€‚</li>
  <li>include_dirsæ˜¯ç¼–è¯‘æ—¶ä½¿ç”¨çš„å¤´æ–‡ä»¶å¼•å…¥è·¯å¾„ï¼Œè¿™é‡Œä½¿ç”¨node -pæ‰§è¡Œnode-addon-apiæ¨¡å—ä¸­çš„é¢„ç½®å˜é‡ã€‚</li>
  <li>dependenciesæ˜¯å¿…é¡»çš„ï¼Œä¸è¦æ”¹å˜ã€‚</li>
  <li>åé¢éƒ¨åˆ†ï¼Œcflags!/cflags_cc!/definesä¸‰è¡ŒæŒ‡å®šå¦‚æœc++ç¨‹åºç¢°åˆ°æ„å¤–é”™è¯¯çš„æ—¶å€™ï¼Œç”±NAPIæ¥å£æ¥å¤„ç†ï¼Œè€Œä¸æ˜¯é€šå¸¸çš„ç”±c++ç¨‹åºè‡ªå·±å¤„ç†ã€‚è¿™é˜²æ­¢å› ä¸ºc++éƒ¨åˆ†ç¨‹åºç¢°åˆ°æ„å¤–ç›´æ¥å°±é€€å‡ºäº†ç¨‹åºï¼Œè€Œæ˜¯ç”±nodejsç¨‹åºæ¥æ•è·å¤„ç†ã€‚å¦‚æœæ˜¯åœ¨Linuxä¸­ç¼–è¯‘ä½¿ç”¨ï¼Œæœ‰è¿™ä¸‰è¡Œå°±å¤Ÿäº†ã€‚</li>
  <li>ä½†å¦‚æœæ˜¯åœ¨macOSä¸Šç¼–è¯‘ä½¿ç”¨ï¼Œåˆ™è¿˜è¦éœ€è¦æœ€åä¸€é¡¹xcode-settingsè®¾ç½®ï¼Œæ„æ€ç›¸åŒï¼Œå°±æ˜¯å…³é—­macOSç¼–è¯‘å™¨çš„æ„å¤–å¤„ç†åŠŸèƒ½ã€‚<br />
æœ€åæ˜¯c++çš„æºç ï¼Œdemocpp.ccæ–‡ä»¶ï¼š</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;napi.h&gt;</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Napi</span><span class="p">;</span>

<span class="n">String</span> <span class="nf">Hello</span><span class="p">(</span><span class="k">const</span> <span class="n">CallbackInfo</span><span class="o">&amp;</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">String</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">Env</span><span class="p">(),</span> <span class="s">"world"</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Napi</span><span class="o">::</span><span class="n">Object</span>  <span class="nf">Init</span><span class="p">(</span><span class="n">Env</span> <span class="n">env</span><span class="p">,</span> <span class="n">Object</span> <span class="n">exports</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">exports</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span> <span class="n">Function</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">Hello</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">exports</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">NODE_API_MODULE</span><span class="p">(</span><span class="n">addon</span><span class="p">,</span> <span class="n">Init</span><span class="p">)</span>

</code></pre></div></div>
<p>ç¨‹åºä¸­å¼•å…¥napi.hå¤´æ–‡ä»¶ï¼Œä½¿ç”¨Napiçš„namespaceè¿˜æœ‰æœ€åçš„NODE_API_MODULE(addon,Init)éƒ½æ˜¯æ¨¡æ¿åŒ–çš„ï¼Œç…§æŠ„è¿‡æ¥ä¸ç”¨åŠ¨ã€‚<br />
Initå‡½æ•°ä¸­ï¼Œä½¿ç”¨<code class="language-plaintext highlighter-rouge">exports.Set()</code>å¼•å‡ºè¦æš´éœ²ç»™nodejsè°ƒç”¨çš„å‡½æ•°ã€‚å¦‚æœæœ‰å¤šä¸ªéœ€è¦å¼•å‡ºçš„å‡½æ•°ï¼Œå°±å†™å¤šè¡Œã€‚<br />
Helloå‡½æ•°æ˜¯æˆ‘ä»¬ä¸»è¦å®Œæˆå·¥ä½œçš„éƒ¨åˆ†ï¼Œæœ¬ä¾‹ä¸­å¾ˆç®€å•ï¼Œåªæ˜¯ç”¨å­—ç¬¦ä¸²çš„æ–¹å¼è¿”å›ä¸€ä¸ªâ€œworldâ€ã€‚</p>

<p>ä»¥ä¸Šdemocpp.cc/binding.gyp/package.jsonä¸‰ä¸ªæ–‡ä»¶å‡†å¤‡å¥½ä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œæ‰§è¡Œï¼š<code class="language-plaintext highlighter-rouge">npm install</code>ï¼Œé¡ºåˆ©çš„è¯ä¼šå¾—åˆ°è¿™æ ·çš„è¾“å‡ºä¿¡æ¯ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install</span>

<span class="o">&gt;</span> test-cpp-module@0.1.0 <span class="nb">install</span> /home/andrew/Documents/dev/html/nodejs/callcpp
<span class="o">&gt;</span> node-gyp rebuild

  SOLINK_MODULE<span class="o">(</span>target<span class="o">)</span> Release/nothing.node
  CXX<span class="o">(</span>target<span class="o">)</span> Release/obj.target/democpp/democpp.o
  SOLINK_MODULE<span class="o">(</span>target<span class="o">)</span> Release/democpp.node
</code></pre></div></div>
<p>è¿™è¡¨ç¤ºç¼–è¯‘é¡ºåˆ©å®Œæˆäº†ï¼Œå¦‚æœç¢°åˆ°é”™è¯¯ï¼Œå¯ä»¥æ ¹æ®é”™è¯¯ä¿¡æ¯å»åˆ¤æ–­è§£å†³æ–¹æ¡ˆã€‚é€šå¸¸éƒ½æ˜¯ç¯å¢ƒé…ç½®ç¼ºå°‘ç›¸å…³ç¨‹åºæˆ–è€…ä¸Šè¿°çš„ä¸‰ä¸ªæ–‡ä»¶æœ‰æ‰“å­—é”™è¯¯ã€‚<br />
ä¸‹é¢æˆ‘ä»¬éªŒè¯ä¸€ä¸‹æ¨¡å—çš„ç¼–è¯‘ç»“æœï¼Œåœ¨å‘½ä»¤è¡Œä½¿ç”¨nodejsï¼Œå¼•å…¥ç¼–è¯‘çš„æ¨¡å—æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨helloå‡½æ•°æ¥çœ‹çœ‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nv">$ </span>node
<span class="o">&gt;</span> <span class="nv">democpp</span><span class="o">=</span>require<span class="o">(</span><span class="s2">"./build/Release/democpp.node"</span><span class="o">)</span>
<span class="o">{</span> hello: <span class="o">[</span>Function] <span class="o">}</span>
<span class="o">&gt;</span> democpp.hello<span class="o">()</span>
<span class="s1">'world'</span>
<span class="o">&gt;</span> 
</code></pre></div></div>

<p>ä¸Šé¢æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªèŒƒä¾‹ï¼Œä¸‹é¢æˆ‘ä»¬å¢åŠ ä¸€ç‚¹éš¾åº¦ã€‚åœ¨GNUçš„ç¯å¢ƒä¸‹ï¼Œé€šå¸¸æˆ‘ä»¬çš„ç¨‹åºéƒ½ä¼šåŒ…å«å¾ˆå¤šç¬¬ä¸‰æ–¹çš„æ‰©å±•åº“ï¼Œæˆ‘ä»¬è¿™é‡Œå†ä¸¾ä¸€ä¸ªè°ƒç”¨opensslçš„ä¾‹å­ï¼š<br />
package.jsonæ–‡ä»¶ä¸ç”¨ä¿®æ”¹ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨nodejså±‚é¢å¢åŠ æ–°çš„ä¾èµ–åŒ…ã€‚<br />
ç¼–è¯‘å¸¦ç¬¬ä¸‰æ–¹æ‰©å±•åº“çš„c++ç¨‹åºï¼Œé€šå¸¸éœ€è¦åœ¨ç¼–è¯‘æ—¶æŒ‡å®šé¢å¤–çš„å¤´æ–‡ä»¶åŒ…å«è·¯å¾„å’Œé“¾æ¥ç¬¬ä¸‰æ–¹åº“ï¼Œè¿™äº›éƒ½æ˜¯åœ¨binding.gypä¸­æŒ‡å®šçš„ï¼Œè¿™äº›æŒ‡å®šåœ¨nodejsè‡ªåŠ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šè§£æå¹¶åº”ç”¨åœ¨å‘½ä»¤è¡Œçš„ç¼–è¯‘å·¥å…·ä¸­ã€‚</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">targets</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="dl">"</span><span class="s2">target_name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">democpp</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">sources</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">democpp.cc</span><span class="dl">"</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">include_dirs</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">&lt;!@(node -p </span><span class="se">\"</span><span class="s2">require('node-addon-api').include</span><span class="se">\"</span><span class="s2">)</span><span class="dl">"</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">libraries</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> 
        <span class="dl">'</span><span class="s1">-lssl -lcrypto</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">dependencies</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">&lt;!(node -p </span><span class="se">\"</span><span class="s2">require('node-addon-api').gyp</span><span class="se">\"</span><span class="s2">)</span><span class="dl">"</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">cflags!</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">-fno-exceptions</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">cflags_cc!</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">-fno-exceptions</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">defines</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">NAPI_CPP_EXCEPTIONS</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">xcode_settings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">GCC_ENABLE_CPP_EXCEPTIONS</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">YES</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>
<p>åœ¨macOSå’Œå¸¸ç”¨linuxç‰ˆæœ¬ä¸­ï¼Œopensslçš„å¤´æ–‡ä»¶ä¼šè‡ªåŠ¨å®‰è£…åœ¨ç³»ç»Ÿçš„å¤´æ–‡ä»¶è·¯å¾„ä¸­ï¼Œæ¯”å¦‚/usr/local/include,æ‰€ä»¥è¿™é‡Œå¤´æ–‡ä»¶çš„å¼•å…¥è·¯å¾„å¹¶æ²¡æœ‰å¢åŠ ã€‚å¦‚æœä½¿ç”¨äº†è‡ªå·±å®‰è£…çš„æ‰©å±•åº“ï¼Œéœ€è¦åœ¨include_dirsä¸€èŠ‚å¢åŠ æ–°çš„å¤´æ–‡ä»¶åŒ…å«è·¯å¾„ã€‚<br />
æ¥ç€å¢åŠ äº†librariesä¸€èŠ‚ï¼ŒæŒ‡å®šäº†Opensslæ‰©å±•åº“çš„é“¾æ¥å‚æ•°<code class="language-plaintext highlighter-rouge">-lssl -lcrypto</code>ï¼Œè¿™ä¸ªæ˜¯å¿…é¡»çš„ã€‚<br />
æœ€åæ˜¯ä¿®æ”¹democpp.ccæ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªä½¿ç”¨opensslä¸­çš„md5ç®—æ³•å¯¹å­—ç¬¦ä¸²è¿›è¡Œmd5ç¼–ç çš„å‡½æ•°ï¼š</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;napi.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;openssl/md5.h&gt;</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Napi</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">openssl_md5</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">){</span>
	<span class="n">MD5_CTX</span> <span class="n">c</span><span class="p">;</span>
	<span class="n">MD5_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
	<span class="n">MD5_Update</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">size</span><span class="p">);</span>
	<span class="n">MD5_Final</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">String</span> <span class="nf">GetMD5</span><span class="p">(</span><span class="k">const</span> <span class="n">CallbackInfo</span><span class="o">&amp;</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Env</span> <span class="n">env</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">Env</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">password</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">As</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">().</span><span class="n">Utf8Value</span><span class="p">();</span>
  <span class="c1">//printf("md5 in str:%s %ld\n",password.c_str(),password.size());</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hash</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span>
  <span class="n">openssl_md5</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="n">password</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="n">hash</span><span class="p">);</span>
  <span class="kt">char</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">md5str</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span><span class="o">=</span><span class="p">{};</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
	  <span class="n">sprintf</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="s">"%02x"</span><span class="p">,</span><span class="n">hash</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	  <span class="n">strcat</span><span class="p">(</span><span class="n">md5str</span><span class="p">,</span><span class="n">tmp</span><span class="p">);</span>
	<span class="p">}</span>
  <span class="k">return</span> <span class="n">String</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">md5str</span><span class="p">,</span><span class="mi">32</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">String</span> <span class="nf">Hello</span><span class="p">(</span><span class="k">const</span> <span class="n">CallbackInfo</span><span class="o">&amp;</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">String</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">Env</span><span class="p">(),</span> <span class="s">"world"</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Napi</span><span class="o">::</span><span class="n">Object</span>  <span class="nf">Init</span><span class="p">(</span><span class="n">Env</span> <span class="n">env</span><span class="p">,</span> <span class="n">Object</span> <span class="n">exports</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">exports</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span> <span class="n">Function</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">Hello</span><span class="p">));</span>
  <span class="n">exports</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"md5"</span><span class="p">,</span> <span class="n">Function</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">GetMD5</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">exports</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">NODE_API_MODULE</span><span class="p">(</span><span class="n">addon</span><span class="p">,</span> <span class="n">Init</span><span class="p">)</span>
</code></pre></div></div>
<p>ä¸ºäº†å·¥ä½œæ–¹ä¾¿ï¼Œæºç ä¸­å¢åŠ äº†ä¸€ä¸ªæ²¡æœ‰å¼•å‡ºçš„openssl_md5å‡½æ•°ï¼Œä»…ä¾›ç¨‹åºå†…éƒ¨ä½¿ç”¨ã€‚å› ä¸ºæ²¡æœ‰å¼•å‡ºï¼Œnodejså¹¶ä¸çŸ¥é“è¿™ä¸ªå‡½æ•°çš„å­˜åœ¨ã€‚<br />
ä»nodejsä¼ é€’å‚æ•°ç»™c++çš„å‡½æ•°ï¼Œæ˜¯ä½¿ç”¨<code class="language-plaintext highlighter-rouge">info[0].As&lt;String&gt;().Utf8Value()</code>è¿™æ ·çš„å½¢å¼ã€‚è¿”å›å€¼åˆ°nodejsåœ¨helloå‡½æ•°ä¸­å°±å·²ç»çœ‹è¿‡äº†ã€‚<br />
å„é¡¹ä¿®æ”¹å®Œæˆï¼ŒåŒæ ·å›åˆ°å‘½ä»¤è¡Œä½¿ç”¨<code class="language-plaintext highlighter-rouge">npm install</code>é‡æ–°ç¼–è¯‘ã€‚ç¼–è¯‘çš„è¿‡ç¨‹å’Œä¿¡æ¯ç•¥ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹è°ƒç”¨çš„æµ‹è¯•ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nv">$ </span>node
<span class="o">&gt;</span> <span class="nv">democpp</span><span class="o">=</span>require<span class="o">(</span><span class="s2">"./build/Release/democpp.node"</span><span class="o">)</span>
<span class="o">{</span> hello: <span class="o">[</span>Function], md5: <span class="o">[</span>Function] <span class="o">}</span>
<span class="o">&gt;</span> democpp.hello<span class="o">()</span>
<span class="s1">'world'</span>
<span class="o">&gt;</span> democpp.md5<span class="o">(</span><span class="s2">"abc"</span><span class="o">)</span>
<span class="s1">'900150983cd24fb0d6963f7d28e17f72'</span>
<span class="o">&gt;</span> 
</code></pre></div></div>
<p>æƒ³éªŒè¯ä¸€ä¸‹è®¡ç®—çš„æ­£ç¡®æ€§ï¼Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œopensslè¯•è¯•ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"abc"</span> | openssl md5
900150983cd24fb0d6963f7d28e17f72
</code></pre></div></div>
<p>å—¯ï¼Œæ— æ‚¬å¿µçš„ç›¸åŒã€‚</p>

<h4 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h4>
<p><a href="https://github.com/kriasoft/nodejs-api-starter">https://github.com/kriasoft/nodejs-api-starter</a><br />
<a href="https://github.com/nodejs/node-addon-api/blob/master/doc/node-gyp.md">https://github.com/nodejs/node-addon-api/blob/master/doc/node-gyp.md</a></p>

:ET