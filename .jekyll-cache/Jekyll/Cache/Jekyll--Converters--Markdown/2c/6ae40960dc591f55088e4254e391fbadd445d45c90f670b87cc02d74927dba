I" P<p><img src="https://raw.githubusercontent.com/formoon/formoon.github.io/master/attachments/201712/mp3.jpeg" alt="" />
æœ‰ä¸ªä¸å¥½æ„æ€çš„åä¹ æƒ¯ï¼Œç»å¸¸åœ¨ç½‘ä¸Šä¸‹è½½ä¸€äº›MP3éŸ³ä¹ï¼Œå¤§å®¶å¯åˆ«å­¦æˆ‘ï¼Œè¯·åŠªåŠ›æ”¯æŒæ­£ç‰ˆã€‚<br />
å¾ˆå¤šä¸åŒæ—¶é—´ã€ä¸åŒæ¥æºçš„MP3ï¼Œä¸€èˆ¬é‡‡ç”¨äº†ä¸åŒçš„å‘½åè§„åˆ™ï¼Œæˆ–è€…å¹²è„†å°±æ˜¯æ··ä¹±çš„å‘½åï¼Œæ¯”å¦‚ä¸€ä¸²è°ä¹Ÿçœ‹ä¸æ‡‚çš„æ•°å­—ï¼Œæ„Ÿè§‰è¿™äº›èµ·åå­—çš„äººå®åœ¨æ˜¯ä¸èµ°å¿ƒã€‚<br />
ä½†ç®¡ç†èµ·æ¥æˆ–è€…æ¬£èµèµ·æ¥ï¼Œè¿™äº›æ‚ä¹±çš„åå­—å°±å®åœ¨å¤ªä»¤äººæ¼ç«äº†ã€‚è‡ªå·±å†™äº†ä¸€ä¸ªå°ç¨‹åºï¼Œè¯»å–MP3éŸ³ä¹ä¸­çš„æ ‡ç­¾(Taginfo)ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¸€èˆ¬æ˜¯å‹åˆ¶MP3çš„æ—¶å€™ç›´æ¥ä»CDä¸­å¾—åˆ°å¹¶ä¸”ä¿å­˜åˆ°MP3æ–‡ä»¶çš„ï¼Œç„¶åç”¨è¿™äº›ä¿¡æ¯é‡æ–°å‘½åMP3æ–‡ä»¶ï¼Œæˆ‘å½“å‰é‡‡ç”¨çš„æ–¹å¼æ˜¯â€œè‰ºæœ¯å®¶+æ›²å.mp3â€,æºç å†…å¾ˆæ¸…æ¥šï¼Œå¦‚æœæœ‰ä¸åŒçš„éœ€æ±‚å¯ä»¥è‡ªå·±å†ä¿®æ”¹ã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
# -*- coding: utf-8 -*-
#usage: ./mp3rename.py  ~/mp3/*mp3
#prepare: pip install mutagen
</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
<span class="kn">from</span> <span class="nn">mutagen.mp3</span> <span class="kn">import</span> <span class="n">MP3</span>

<span class="k">def</span> <span class="nf">hexdump</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">16</span><span class="p">):</span>
        <span class="n">lin</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="n">b</span> <span class="p">:</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">16</span><span class="p">]]</span>
        <span class="n">hxdat</span> <span class="o">=</span> <span class="s">' '</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">'%02X'</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lin</span><span class="p">)</span>
        <span class="n">pdat</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">((</span><span class="n">c</span> <span class="k">if</span> <span class="mi">32</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">126</span> <span class="k">else</span> <span class="s">'.'</span> <span class="p">)</span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lin</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">'  %04x: %-48s %s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">hxdat</span><span class="p">,</span> <span class="n">pdat</span><span class="p">)</span>
    <span class="k">print</span>

<span class="k">def</span> <span class="nf">ustr2str</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
	<span class="n">tstr</span> <span class="o">=</span> <span class="sa">b</span><span class="s">''</span>
	<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
		<span class="n">n</span><span class="o">=</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
		<span class="n">tstr</span> <span class="o">=</span> <span class="n">tstr</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">tstr</span>
			
<span class="k">def</span> <span class="nf">gb2utf</span><span class="p">(</span><span class="n">sstr</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">ustr2str</span><span class="p">(</span><span class="n">sstr</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'gbk'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">muReadMp3ID</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">MP3</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">'TPE1'</span> <span class="ow">in</span> <span class="n">audio</span><span class="p">:</span>
        <span class="n">s1Artist</span><span class="o">=</span><span class="n">audio</span><span class="p">[</span><span class="s">'TPE1'</span><span class="p">].</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s1Artist</span><span class="o">=</span><span class="s">""</span>
    <span class="k">if</span> <span class="s">'TIT2'</span> <span class="ow">in</span> <span class="n">audio</span><span class="p">:</span> 
        <span class="n">s1Title</span><span class="o">=</span><span class="n">audio</span><span class="p">[</span><span class="s">'TIT2'</span><span class="p">].</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s1Title</span><span class="o">=</span><span class="s">""</span>
    <span class="k">try</span><span class="p">:</span>
    	<span class="n">sArtist</span><span class="o">=</span><span class="n">gb2utf</span><span class="p">(</span><span class="n">s1Artist</span><span class="p">)</span>
    	<span class="n">sTitle</span><span class="o">=</span><span class="n">gb2utf</span><span class="p">(</span><span class="n">s1Title</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
    	<span class="n">sArtist</span><span class="o">=</span><span class="n">s1Artist</span>
    	<span class="n">sTitle</span><span class="o">=</span><span class="n">s1Title</span>
    <span class="k">if</span> <span class="n">sTitle</span><span class="o">==</span><span class="s">""</span><span class="p">:</span>
        <span class="n">sTitle</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#print audio["TRCK"].text[0]
</span>    <span class="n">sArtist</span><span class="o">=</span><span class="n">sArtist</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span><span class="s">'_'</span><span class="p">)</span>
    <span class="n">sTitle</span><span class="o">=</span><span class="n">sTitle</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span><span class="s">'_'</span><span class="p">)</span>
    <span class="n">pathname</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pathname</span> <span class="o">!=</span> <span class="s">""</span><span class="p">:</span>
        <span class="n">newname</span><span class="o">=</span><span class="n">pathname</span><span class="o">+</span><span class="s">"/"</span><span class="o">+</span><span class="n">sArtist</span><span class="o">+</span><span class="s">"_"</span><span class="o">+</span><span class="n">sTitle</span><span class="o">+</span><span class="s">".mp3"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newname</span><span class="o">=</span><span class="n">sArtist</span><span class="o">+</span><span class="s">"_"</span><span class="o">+</span><span class="n">sTitle</span><span class="o">+</span><span class="s">".mp3"</span>
    <span class="n">newname</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">'[: ]'</span><span class="p">,</span><span class="s">'_'</span><span class="p">,</span><span class="n">newname</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">filename</span><span class="p">,</span><span class="s">" =&gt; "</span><span class="p">,</span><span class="n">newname</span>
    <span class="n">os</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">newname</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>
    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">SystemExit</span><span class="p">(</span><span class="n">parser</span><span class="p">.</span><span class="n">print_help</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="n">muReadMp3ID</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>	

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span>
</code></pre></div></div>
<p>å› ä¸ºä½¿ç”¨äº†mutagenä»£ç åŒ…ï¼Œæ‰€ä»¥ä½¿ç”¨ä¹‹å‰è¦å…ˆå®‰è£…ä¸€ä¸‹<code class="language-plaintext highlighter-rouge">pip install mutagen</code>ã€‚å¦å¤–è¦æ³¨æ„ï¼Œæœ‰ä¸ªåˆ«æ­Œæ›²å†…ç½®å°±æ²¡æœ‰taginfo,å½“ç„¶ç°åœ¨è¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼Œæˆ‘åªè§è¿‡2é¦–ç‰¹åˆ«æƒ…å†µï¼Œè¿™ç§æƒ…å†µçš„è¯ï¼Œç¨‹åºå°†åªåœ¨æºæ–‡ä»¶åä¹‹å‰å¢åŠ â€_â€œã€‚</p>

<p>å¾ˆå¤šä½¿ç”¨ç›®å‰æ¯”è¾ƒç«çš„éŸ³ä¹appä¸‹è½½çš„æ­Œæ›²ï¼Œåç¼€æ˜¯m4a,æ˜¯MP4æ ‡å‡†ä¸­çš„éŸ³é¢‘æ ¼å¼ã€‚è¿™ç§æ–¹å¼æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œè¯¸å¦‚å‹ç¼©ç‡æ›´é«˜ã€åŒæ ·å®¹é‡éŸ³è´¨æ›´å¥½ï¼Œå¯ä»¥åŠ å¯†ç­‰ç­‰ï¼Œè¿™é‡Œä¸åšæŠ€æœ¯ç§‘æ™®ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šã€‚ç„¶åä¸ºäº†åº”å¯¹è¿™ç§æ–‡ä»¶çš„æƒ…å†µï¼Œæ”¹å†™äº†ç±»ä¼¼ç¨‹åºæ¥å®Œæˆm4aæ–‡ä»¶çš„æ‰¹é‡æ”¹åï¼Œè€ƒè™‘å¾ˆå¤šçš„éšèº«å¬å®é™…ä¸Šæ˜¯ä»¥mp3ä¸ºä¸»çš„ï¼Œè¿™é‡Œå°±ä¸åˆå¹¶åˆ°ä¸€ä¸ªç¨‹åºäº†ã€‚m4arename.pyåˆ†äº«å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
# -*- coding: utf-8 -*-
#./m4arename.py  ~/m4a/*
#prepare: pip install mutagen
</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
<span class="kn">from</span> <span class="nn">mutagen.mp4</span> <span class="kn">import</span> <span class="n">MP4</span>

<span class="k">def</span> <span class="nf">hexdump</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">16</span><span class="p">):</span>
        <span class="n">lin</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="n">b</span> <span class="p">:</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">16</span><span class="p">]]</span>
        <span class="n">hxdat</span> <span class="o">=</span> <span class="s">' '</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">'%02X'</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lin</span><span class="p">)</span>
        <span class="n">pdat</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">((</span><span class="n">c</span> <span class="k">if</span> <span class="mi">32</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">126</span> <span class="k">else</span> <span class="s">'.'</span> <span class="p">)</span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lin</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">'  %04x: %-48s %s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">hxdat</span><span class="p">,</span> <span class="n">pdat</span><span class="p">)</span>
    <span class="k">print</span>

<span class="k">def</span> <span class="nf">ustr2str</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
	<span class="n">tstr</span> <span class="o">=</span> <span class="sa">b</span><span class="s">''</span>
	<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
		<span class="n">n</span><span class="o">=</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
		<span class="n">tstr</span> <span class="o">=</span> <span class="n">tstr</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">tstr</span>
			
<span class="k">def</span> <span class="nf">gb2utf</span><span class="p">(</span><span class="n">sstr</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">ustr2str</span><span class="p">(</span><span class="n">sstr</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'gbk'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">m4afilename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.m4a'</span><span class="p">):</span>
		<span class="k">print</span> <span class="s">"Error filetype, only .m4a allowed"</span>
		<span class="k">return</span>
	<span class="n">audio</span><span class="o">=</span><span class="n">MP4</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
	<span class="n">stitle</span><span class="o">=</span><span class="n">audio</span><span class="p">[</span><span class="s">'</span><span class="se">\xa9</span><span class="s">nam'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">sartist</span><span class="o">=</span><span class="n">audio</span><span class="p">[</span><span class="s">'</span><span class="se">\xa9</span><span class="s">ART'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">newfilename</span><span class="o">=</span><span class="n">sartist</span><span class="o">+</span><span class="n">stitle</span><span class="o">+</span><span class="s">".m4a"</span>
	<span class="n">newfilename</span><span class="o">=</span><span class="n">newfilename</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span><span class="s">"-"</span><span class="p">)</span>
	<span class="k">print</span> <span class="s">"["</span><span class="o">+</span><span class="n">newfilename</span><span class="o">+</span><span class="s">"]"</span>	
	<span class="n">os</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">newfilename</span><span class="p">)</span>
	<span class="c1">#os.system(doCmdStr)
</span>	

    
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>
    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">SystemExit</span><span class="p">(</span><span class="n">parser</span><span class="p">.</span><span class="n">print_help</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="n">m4afilename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>	

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span>
</code></pre></div></div>
:ET