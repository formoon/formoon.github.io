I"@¡<p><img src="http://115.182.41.123/files/201904/tensorFlow2/tf-logo-card-2.png" alt="" /></p>
<h4 id="å›¾ç‰‡æ ·æœ¬å¯è§†åŒ–">å›¾ç‰‡æ ·æœ¬å¯è§†åŒ–</h4>
<p><a href="http://blog.17study.com.cn/2018/01/10/tensorFlow-series-4/">åŸæ–‡ç¬¬å››ç¯‡</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å®˜æ–¹çš„å…¥é—¨æ¡ˆä¾‹MNISTï¼ŒåŠŸèƒ½æ˜¯è¯†åˆ«æ‰‹å†™çš„æ•°å­—0-9ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„TensorFlowåº”ç”¨ï¼Œåœ°ä½ç›¸å½“äºé€šå¸¸è¯­è¨€å­¦ä¹ çš„â€Hello World!â€ã€‚<br />
æˆ‘ä»¬å…ˆä¸è¿›å…¥TensorFlow 2.0ä¸­çš„MNISTä»£ç è®²è§£ï¼Œå› ä¸ºTensorFlow 2.0åœ¨Kerasçš„å¸®åŠ©ä¸‹æŠ½è±¡åº¦æ¯”è¾ƒé«˜ï¼Œä»£ç éå¸¸ç®€å•ã€‚ä½†è¿™ä¹Ÿä½¿å¾—å¤§é‡çš„å·¥ä½œè¢«éšè—æ‰ï¼Œåè€Œè®©äººéš¾ä»¥çœŸæ­£ç†è§£æ¥é¾™å»è„‰ã€‚ç‰¹åˆ«æ˜¯å…¶ä¸­æ‰€ä½¿ç”¨çš„æ ·æœ¬æ•°æ®ä¹Ÿå·²ç»ä¸åŒï¼Œè€Œè¿™å¯¹äºå­¦ä¹ è€…ï¼Œæ˜¯éå¸¸é‡è¦çš„éƒ¨åˆ†ã€‚æ¨¡å‹å¯ä»¥çœ‹è®ºæ–‡ã€åœ¨ç½‘ä¸Šæ‰¾æˆç†Ÿçš„æˆæœï¼Œæ•°æ®çš„æ”¶é›†å’Œå¤„ç†ï¼Œå¯ä¸ä¼šæœ‰äººå¸®å¿™ã€‚<br />
åœ¨åŸæ–‡ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä»‹ç»äº†MNISTçš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªå°ç¨‹åºï¼ŒæŠŠæ ·æœ¬ä¸­çš„æ•°ç»„æ•°æ®è½¬æ¢ä¸ºJPGå›¾ç‰‡ï¼Œæ¥å¸®åŠ©è¯»è€…ç†è§£åŸå§‹æ•°æ®çš„ç»„ç»‡æ–¹å¼ã€‚<br />
è¿™é‡Œæˆ‘ä»¬æŠŠå°ç¨‹åºä¹Ÿå‡çº§ä¸€ä¸‹ï¼Œç›´æ¥æŠŠå›¾ç‰‡æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œä¸å†å¦å¤–ä¿å­˜JPGæ–‡ä»¶ã€‚è¿™æ ·å›¾ç‰‡çœ‹èµ·æ¥æ›´å¿«æ›´ç›´è§‚ã€‚<br />
åœ¨TensorFlow 1.xä¸­ï¼Œæ˜¯ä½¿ç”¨ç¨‹åºinput_data.pyæ¥ä¸‹è½½å’Œç®¡ç†MNISTçš„æ ·æœ¬æ•°æ®é›†ã€‚å½“å‰å®˜æ–¹ä»“åº“çš„masteråˆ†æ”¯ä¸­å·²ç»å–æ¶ˆäº†è¿™ä¸ªä»£ç ï¼Œä¸ºäº†ä¸å»ç¿»ä»“åº“ï¼Œä½ å¯ä»¥åœ¨<a href="http://115.182.41.123/files/201904/tensorFlow2/input_data.py">è¿™é‡Œ</a>ä¸‹è½½ï¼Œæ”¾ç½®åˆ°ä½ çš„å·¥ä½œç›®å½•ã€‚<br />
åœ¨TensorFlow 2.0ä¸­ï¼Œä¼šæœ‰keras.datasetsç±»æ¥ç®¡ç†å¤§éƒ¨åˆ†çš„æ¼”ç¤ºå’Œæ¨¡å‹ä¸­éœ€è¦ä½¿ç”¨çš„æ•°æ®é›†ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢å†è®²ã€‚<br />
MNISTçš„æ ·æœ¬æ•°æ®æ¥è‡ª<a href="http://yann.lecun.com/exdb/mnist/">Yann LeCun</a>çš„é¡¹ç›®ç½‘ç«™ã€‚å¦‚æœç½‘é€Ÿæ¯”è¾ƒæ…¢çš„è¯ï¼Œå¯ä»¥å…ˆç”¨ä¸‹è½½å·¥å…·ä¸‹è½½ï¼Œç„¶åæ”¾ç½®åˆ°è‡ªå·±è®¾ç½®çš„æ•°æ®ç›®å½•ï¼Œæ¯”å¦‚å·¥ä½œç›®å½•ä¸‹çš„dataæ–‡ä»¶å¤¹ï¼Œinput_dataæ£€æµ‹åˆ°å·²æœ‰æ•°æ®çš„è¯ï¼Œä¸ä¼šé‡å¤ä¸‹è½½ã€‚<br />
ä¸‹é¢æ˜¯æˆ‘ä»¬å‡çº§åæ˜¾ç¤ºè®­ç»ƒæ ·æœ¬é›†çš„æºç ï¼Œä»£ç çš„è®²è§£ä¿ç•™åœ¨æ³¨é‡Šä¸­ã€‚å¦‚æœé˜…è¯»æœ‰ç–‘é—®çš„ï¼Œå»ºè®®å…ˆå»åŸæ–‡ä¸­çœ‹ä¸€ä¸‹æ ·æœ¬é›†æ•°æ®ç»“æ„çš„å›¾ç¤ºéƒ¨åˆ†ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="c1"># å¼•å…¥mnistæ•°æ®é¢„è¯»å‡†å¤‡åº“
# 2.0ä¹‹åå»ºè®®ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„keras.datasets.mnist.load_data
# æ­¤å¤„ä¸ºäº†åŒä»¥å‰çš„è®²è§£å¯¹æ¯”ï¼Œæ²¿ç”¨ä¹‹å‰çš„å¼•ç”¨æ–‡ä»¶
</span><span class="kn">import</span> <span class="nn">input_data</span>
<span class="c1"># tensorflow 2.0åº“
</span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="c1"># å¼•å…¥ç»˜å›¾åº“
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># è¿™é‡Œä½¿ç”¨mnistæ•°æ®é¢„è¯»å‡†å¤‡åº“æ£€æŸ¥ç»™å®šè·¯å¾„æ˜¯å·²ç»æœ‰æ ·æœ¬æ•°æ®ï¼Œ
# æ²¡æœ‰çš„è¯å»ç½‘ä¸Šä¸‹è½½ï¼Œå¹¶ä¿å­˜åœ¨æŒ‡å®šç›®å½•
# å·²ç»ä¸‹è½½äº†æ•°æ®çš„è¯ï¼Œå°†æ•°æ®è¯»å…¥å†…å­˜ï¼Œä¿å­˜åˆ°mnistå¯¹è±¡ä¸­
</span><span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s">"data/"</span><span class="p">,</span> <span class="n">one_hot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># æ ·æœ¬é›†çš„ç»“æ„å¦‚ä¸‹ï¼š
# mnist.train è®­ç»ƒæ•°æ®é›†
# mnist.validation éªŒè¯æ•°æ®é›†
# mnist.test æµ‹è¯•æ•°æ®é›†
# len(mnist.train.images)=55000
# len(mnist.train.images[0])=784
# len(mnist.train.labels[0])=10
</span>

<span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">imgs</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="c1"># å°†1ç»´çš„0-1çš„æ•°æ®è½¬æ¢ä¸ºæ ‡å‡†çš„0-255çš„æ•´æ•°æ•°æ®ï¼Œ2ç»´28x28çš„å›¾ç‰‡
</span>    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">256.0</span> <span class="o">*</span> <span class="n">tf</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">]))</span>
    <span class="c1"># åŸæ•°æ®ä¸ºfloatï¼Œè½¬æ¢ä¸ºuint8å­—èŠ‚æ•°æ®
</span>    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">cast</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="c1"># æ ‡ç­¾æ ·æœ¬ä¸º10ä¸ªå­—èŠ‚çš„æ•°ç»„ï¼Œä¸º1çš„å…ƒç´ ä¸‹æ ‡å°±æ˜¯æ ·æœ¬çš„æ ‡ç­¾å€¼
</span>    <span class="c1"># è¿™é‡Œä½¿ç”¨argmaxæ–¹æ³•ç›´æ¥è½¬æ¢ä¸º0-9çš„æ•´æ•°
</span>    <span class="n">label</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="c1"># ç»˜åˆ¶æ ·æœ¬å›¾
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="c1"># æ˜¾ç¤ºæ ‡ç­¾å€¼
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">show_images</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">num_images</span> <span class="o">=</span> <span class="n">num_rows</span><span class="o">*</span><span class="n">num_cols</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="s">'Train Samples'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_cols</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">num_rows</span><span class="p">))</span>
    <span class="c1"># å¾ªç¯æ˜¾ç¤ºå‰num_rows*num_colså‰¯æ ·æœ¬å›¾ç‰‡
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">):</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># æ˜¾ç¤ºå‰4*6=24å‰¯è®­ç»ƒé›†æ ·æœ¬
</span><span class="n">show_images</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">mnist</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">images</span><span class="p">,</span> <span class="n">mnist</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">labels</span><span class="p">)</span>
</code></pre></div></div>
<p>æ³¨æ„è¿™ä¸ªä»£ç åªæ˜¯ç”¨æ¥æŠŠæ ·æœ¬é›†å¯è§†åŒ–ã€‚TensorFlow 2.0æ–°ç‰¹å¾ï¼Œåœ¨è¿™é‡Œåªä½“ç°äº†å–æ¶ˆSessionå’ŒSession.run()ã€‚ç›®çš„åªæ˜¯ä¸ºäº†å»¶ç»­åŸæ¥çš„è®²è§£ï¼Œè®©å›¾ç‰‡ç›´æ¥æ˜¾ç¤ºè€Œä¸æ˜¯ä¿å­˜ä¸ºå›¾åƒæ–‡ä»¶ï¼Œä»¥åŠå‡çº§åˆ°Python3å’ŒTensorFlow 2.0çš„æ‰§è¡Œç¯å¢ƒã€‚<br />
æ ·æœ¬é›†æ˜¾ç¤ºå‡ºæ¥æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š<br />
<img src="http://115.182.41.123/files/201904/tensorFlow2/mnist-train_Samples.png" alt="" /></p>

<h4 id="tensorflow-20ä¸­çš„æ¨¡å‹æ„å»º">TensorFlow 2.0ä¸­çš„æ¨¡å‹æ„å»º</h4>
<p>åŸæ–‡ç¬¬å››ç¯‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¹¶ä¸å®ç”¨çš„çº¿æ€§å›å½’æ¨¡å‹æ¥åšæ‰‹å†™æ•°å­—è¯†åˆ«ã€‚è¿™æ ·åšå¯ä»¥ç®€åŒ–ä¸­é—´å±‚ï¼Œä»è€Œèƒ½å¤Ÿä½¿ç”¨å¯è§†åŒ–çš„æ‰‹æ®µæ¥è®²è§£æœºå™¨è§†è§‰åœ¨æ•°å­¦ä¸Šçš„åŸºæœ¬åŸç†ã€‚å› ä¸ºçº¿æ€§å›å½’æ¨¡å‹æˆ‘ä»¬åœ¨æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡ä¸­è®²è¿‡äº†ï¼Œè¿™é‡Œå°±è·³è¿‡ï¼Œç›´æ¥è¯´ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥è§£å†³MNISTé—®é¢˜ã€‚<br />
ç¥ç»ç½‘ç»œæ¨¡å‹çš„æ„å»ºåœ¨TensorFlow 1.0ä¸­æ˜¯æœ€ç¹ççš„å·¥ä½œã€‚æˆ‘ä»¬æ›¾ç»ä¸ºäº†è®²è§£vgg-19ç¥ç»ç½‘ç»œçš„ä½¿ç”¨ï¼Œé¦–å…ˆç¼–å†™äº†ä¸€ä¸ªå¤æ‚çš„è¾…åŠ©ç±»ï¼Œç”¨äºä»å­—ç¬¦ä¸²æ•°ç»„çš„éå†ä¸­è‡ªåŠ¨æ„å»ºå¤æ‚çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚<br />
è€Œåœ¨TensorFlow 2.0ä¸­ï¼Œé€šè¿‡é«˜åº¦æŠ½è±¡çš„kerasï¼Œå¯ä»¥éå¸¸å®¹æ˜“çš„æ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹ã€‚<br />
ä¸ºäº†å¸®åŠ©ç†è§£ï¼Œæˆ‘ä»¬å…ˆæŠŠTensorFlow 1.0ä¸­ä½¿ç”¨ç¥ç»ç½‘ç»œè§£å†³MNISTé—®é¢˜çš„ä»£ç åŸæ–‡ç²˜è´´å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
# -*- coding=UTF-8 -*-
</span>
<span class="kn">import</span> <span class="nn">input_data</span>
<span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s">'data/'</span><span class="p">,</span> <span class="n">one_hot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">InteractiveSession</span><span class="p">()</span>

<span class="c1">#å¯¹W/båšåˆå§‹åŒ–æœ‰åˆ©äºé˜²æ­¢ç®—æ³•é™·å…¥å±€éƒ¨æœ€ä¼˜è§£ï¼Œ
#æ–‡æ¡£ä¸Šè®²æ˜¯ä¸ºäº†æ‰“ç ´å¯¹ç§°æ€§å’Œé˜²æ­¢0æ¢¯åº¦åŠç¥ç»å…ƒèŠ‚ç‚¹æ’ä¸º0ç­‰é—®é¢˜ï¼Œæ•°å­¦åŸç†æ˜¯ç±»ä¼¼é—®é¢˜
#è¿™ä¸¤ä¸ªåˆå§‹åŒ–å•ç‹¬å®šä¹‰æˆå­ç¨‹åºæ˜¯å› ä¸ºå¤šå±‚ç¥ç»ç½‘ç»œä¼šæœ‰å¤šæ¬¡è°ƒç”¨
</span><span class="k">def</span> <span class="nf">weight_variable</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
    <span class="c1">#å¡«å……â€œæƒé‡â€çŸ©é˜µï¼Œå…¶ä¸­çš„å…ƒç´ ç¬¦åˆæˆªæ–­æ­£æ€åˆ†å¸ƒ
</span>    <span class="c1">#å¯ä»¥æœ‰å‚æ•°meanè¡¨ç¤ºæŒ‡å®šå‡å€¼åŠstddevæŒ‡å®šæ ‡å‡†å·®
</span>  <span class="n">initial</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">truncated_normal</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bias_variable</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
    <span class="c1">#ç”¨0.1å¸¸é‡å¡«å……â€œåç§»é‡â€çŸ©é˜µ
</span>  <span class="n">initial</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span>


<span class="c1">#å®šä¹‰å ä½ç¬¦ï¼Œç›¸å½“äºtensorFlowçš„è¿è¡Œå‚æ•°ï¼Œ
#xæ˜¯è¾“å…¥çš„å›¾ç‰‡çŸ©é˜µï¼Œy_æ˜¯ç»™å®šçš„æ ‡æ³¨æ ‡ç­¾ï¼Œæœ‰æ ‡æ³¨ä¸€å®šæ˜¯ç›‘ç£å­¦ä¹ 
</span><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s">"float"</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="mi">784</span><span class="p">])</span>
<span class="n">y_</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s">"float"</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="c1">#å®šä¹‰è¾“å…¥å±‚ç¥ç»ç½‘ç»œï¼Œæœ‰784ä¸ªèŠ‚ç‚¹ï¼Œ1024ä¸ªè¾“å‡ºï¼Œ
#è¾“å‡ºçš„æ•°é‡æ˜¯è‡ªå·±å®šä¹‰çš„ï¼Œè¦è·Ÿç¬¬äºŒå±‚èŠ‚ç‚¹çš„æ•°é‡å»åˆ
</span><span class="n">W1</span> <span class="o">=</span> <span class="n">weight_variable</span><span class="p">([</span><span class="mi">784</span><span class="p">,</span> <span class="mi">1024</span><span class="p">])</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">bias_variable</span><span class="p">([</span><span class="mi">1024</span><span class="p">])</span>
<span class="c1">#ä½¿ç”¨reluç®—æ³•çš„æ¿€æ´»å‡½æ•°ï¼Œåé¢çš„å…¬å¼è·Ÿå‰ä¸€ä¸ªä¾‹å­ç›¸åŒ
</span><span class="n">h1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">W1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span>

<span class="c1">#å®šä¹‰ç¬¬äºŒå±‚ï¼ˆéšè—å±‚ï¼‰ç½‘ç»œï¼Œ1024è¾“å…¥ï¼Œ512è¾“å‡º
</span><span class="n">W2</span> <span class="o">=</span> <span class="n">weight_variable</span><span class="p">([</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">512</span><span class="p">])</span>
<span class="n">b2</span> <span class="o">=</span> <span class="n">bias_variable</span><span class="p">([</span><span class="mi">512</span><span class="p">])</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">W2</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span>

<span class="c1">#å®šä¹‰ç¬¬ä¸‰å±‚ï¼ˆè¾“å‡ºå±‚ï¼‰ï¼Œ512è¾“å…¥ï¼Œ10è¾“å‡ºï¼Œ10ä¹Ÿæ˜¯æˆ‘ä»¬å¸Œæœ›çš„åˆ†ç±»æ•°é‡
</span><span class="n">W3</span> <span class="o">=</span> <span class="n">weight_variable</span><span class="p">([</span><span class="mi">512</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">b3</span> <span class="o">=</span> <span class="n">bias_variable</span><span class="p">([</span><span class="mi">10</span><span class="p">])</span>
<span class="c1">#æœ€åä¸€å±‚çš„è¾“å‡ºåŒæ ·ç”¨softmaxåˆ†ç±»ï¼ˆä¹Ÿç®—æ˜¯æ¿€æ´»å‡½æ•°å§ï¼‰
</span><span class="n">y3</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">W3</span><span class="p">)</span> <span class="o">+</span> <span class="n">b3</span><span class="p">)</span>

<span class="c1">#äº¤å‰ç†µä»£ä»·å‡½æ•°
</span><span class="n">cross_entropy</span> <span class="o">=</span> <span class="o">-</span><span class="n">tf</span><span class="p">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">y_</span><span class="o">*</span><span class="n">tf</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">y3</span><span class="p">))</span>
<span class="c1">#è¿™é‡Œä½¿ç”¨äº†æ›´åŠ å¤æ‚çš„ADAMä¼˜åŒ–å™¨æ¥åš"æ¢¯åº¦æœ€é€Ÿä¸‹é™"ï¼Œ
#å‰ä¸€ä¸ªä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ï¼šGradientDescentOptimizer
</span><span class="n">train_step</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">).</span><span class="n">minimize</span><span class="p">(</span><span class="n">cross_entropy</span><span class="p">)</span>
<span class="c1">#è®¡ç®—æ­£ç¡®ç‡ä»¥è¯„ä¼°æ•ˆæœ
</span><span class="n">correct_prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">equal</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">cast</span><span class="p">(</span><span class="n">correct_prediction</span><span class="p">,</span> <span class="s">"float"</span><span class="p">))</span>
<span class="c1">#tfåˆå§‹åŒ–åŠæ‰€æœ‰å˜é‡åˆå§‹åŒ–
</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
<span class="c1">#è¿›è¡Œ20000æ­¥çš„è®­ç»ƒ
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20000</span><span class="p">):</span>
    <span class="c1">#æ¯æ‰¹æ•°æ®50ç»„
</span>  <span class="n">batch</span> <span class="o">=</span> <span class="n">mnist</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">next_batch</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
  <span class="c1">#æ¯100æ­¥è¿›è¡Œä¸€æ¬¡æ­£ç¡®ç‡è®¡ç®—å¹¶æ˜¾ç¤ºä¸­é—´ç»“æœ
</span>  <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">train_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="n">x</span><span class="p">:</span><span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_</span><span class="p">:</span> <span class="n">batch</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
    <span class="k">print</span> <span class="s">"step %d, training accuracy %g"</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">)</span>
    <span class="c1">#ä½¿ç”¨æ•°æ®é›†è¿›è¡Œè®­ç»ƒ
</span>  <span class="n">train_step</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_</span><span class="p">:</span> <span class="n">batch</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>

<span class="c1">#å®Œæˆæ¨¡å‹è®­ç»ƒç»™å‡ºæœ€ç»ˆçš„è¯„ä¼°ç»“æœ
</span><span class="k">print</span> <span class="s">"test accuracy %g"</span><span class="o">%</span><span class="n">accuracy</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">mnist</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">images</span><span class="p">,</span> <span class="n">y_</span><span class="p">:</span> <span class="n">mnist</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">labels</span><span class="p">})</span>
</code></pre></div></div>
<p>æ€»ç»“ä¸€ä¸‹ä¸Šé¢TensorFlow 1.xç‰ˆæœ¬MNISTä»£ç ä¸­çš„å·¥ä½œï¼š</p>
<ul>
  <li>ä½¿ç”¨äº†ä¸€ä¸ªä¸‰å±‚çš„ç¥ç»ç½‘ç»œï¼Œæ¯ä¸€å±‚éƒ½ä½¿ç”¨é‡å¤æ€§çš„ä»£ç æ„å»º</li>
  <li>æ¯ä¸€å±‚çš„ä»£ç ä¸­ï¼Œè¦ç²¾å¿ƒè®¡ç®—è¾“å…¥å’Œè¾“å‡ºæ•°æ®çš„æ ¼å¼ã€ç»´åº¦ï¼Œä½¿å¾—æ¯ä¸€å±‚åŒä¸Šã€ä¸‹ä¸¤å±‚å®Œå…¨å»åˆ</li>
  <li>ç²¾å¿ƒè®¾è®¡æŸå¤±å‡½æ•°ï¼ˆä»£ä»·å‡½æ•°ï¼‰å’Œé€‰æ‹©å›å½’ç®—æ³•</li>
  <li>å¤æ‚çš„è®­ç»ƒå¾ªç¯</li>
</ul>

<p>å¦‚æœä½ ç†è§£äº†æˆ‘æ€»ç»“çš„è¿™å‡ ç‚¹ï¼Œè¯·ç»§ç»­çœ‹TensorFlow 2.0çš„å®ç°ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="c1"># å¼•å…¥mnistæ•°æ®é¢„è¯»å‡†å¤‡åº“
# 2.0ä¹‹åå»ºè®®ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„keras.datasets.mnist.load_data
# æ­¤å¤„ä¸ºäº†åŒä»¥å‰çš„è®²è§£å¯¹æ¯”ï¼Œæ²¿ç”¨ä¹‹å‰çš„å¼•ç”¨æ–‡ä»¶
</span><span class="kn">import</span> <span class="nn">input_data</span>
<span class="c1"># tensorflowåº“
</span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="c1"># tensorflow å·²ç»å†…ç½®äº†keras
</span><span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="c1"># å¼•å…¥ç»˜å›¾åº“
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># è¿™é‡Œä½¿ç”¨mnistæ•°æ®é¢„è¯»å‡†å¤‡åº“æ£€æŸ¥ç»™å®šè·¯å¾„æ˜¯å·²ç»æœ‰æ ·æœ¬æ•°æ®ï¼Œ
# æ²¡æœ‰çš„è¯å»ç½‘ä¸Šä¸‹è½½ï¼Œå¹¶ä¿å­˜åœ¨æŒ‡å®šç›®å½•
# å·²ç»ä¸‹è½½äº†æ•°æ®çš„è¯ï¼Œå°†æ•°æ®è¯»å…¥å†…å­˜ï¼Œä¿å­˜åˆ°mnistå¯¹è±¡ä¸­
</span><span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s">"data/"</span><span class="p">,</span> <span class="n">one_hot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># æ ·æœ¬é›†çš„ç»“æ„å¦‚ä¸‹ï¼š
# mnist.train è®­ç»ƒæ•°æ®é›†
# mnist.validation éªŒè¯æ•°æ®é›†
# mnist.test æµ‹è¯•æ•°æ®é›†
# len(mnist.train.images)=55000
# len(mnist.train.images[0])=784
# len(mnist.train.labels[0])=10
</span>

<span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">imgs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">):</span>
    <span class="c1"># å°†1ç»´çš„0-1çš„æ•°æ®è½¬æ¢ä¸ºæ ‡å‡†çš„0-255çš„æ•´æ•°æ•°æ®ï¼Œ2ç»´28x28çš„å›¾ç‰‡
</span>    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">256.0</span> <span class="o">*</span> <span class="n">tf</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">]))</span>
    <span class="c1"># åŸæ•°æ®ä¸ºfloatï¼Œè½¬æ¢ä¸ºuint8å­—èŠ‚æ•°æ®
</span>    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">cast</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="c1"># æ ‡ç­¾æ ·æœ¬ä¸º10ä¸ªå­—èŠ‚çš„æ•°ç»„ï¼Œä¸º1çš„å…ƒç´ ä¸‹æ ‡å°±æ˜¯æ ·æœ¬çš„æ ‡ç­¾å€¼
</span>    <span class="c1"># è¿™é‡Œä½¿ç”¨argmaxæ–¹æ³•ç›´æ¥è½¬æ¢ä¸º0-9çš„æ•´æ•°
</span>    <span class="n">label</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="c1"># ç»˜åˆ¶æ ·æœ¬å›¾
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="c1"># æ˜¾ç¤ºæ ‡ç­¾å€¼ï¼Œå¯¹æ¯”æ˜¾ç¤ºé¢„æµ‹å€¼å’Œå®é™…æ ‡ç­¾å€¼
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"predict:{} label:{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">show_images</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">):</span>
    <span class="n">num_images</span> <span class="o">=</span> <span class="n">num_rows</span><span class="o">*</span><span class="n">num_cols</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="s">'Predict Samples'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_cols</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">num_rows</span><span class="p">))</span>
    <span class="c1"># å¾ªç¯æ˜¾ç¤ºå‰num_rows*num_colså‰¯æ ·æœ¬å›¾ç‰‡
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">):</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># åŸæ–‡ä¸­å·²ç»è¯´æ˜äº†ï¼Œå½“å‰æ˜¯10ä¸ªå…ƒç´ æ•°ç»„è¡¨ç¤ºä¸€ä¸ªæ•°å­—ï¼Œ
# å€¼ä¸º1çš„é‚£ä¸€å…ƒç´ çš„ç´¢å¼•å°±æ˜¯ä»£è¡¨çš„æ•°å­—ï¼Œè¿™æ˜¯åˆ†ç±»ç®—æ³•å†³å®šçš„
# ä¸‹é¢æ˜¯ç›´æ¥è½¬æ¢ä¸º0-9çš„æ­£æ•´æ•°ï¼Œç”¨ä½œè®­ç»ƒçš„æ ‡ç­¾
</span><span class="n">train_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mnist</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">labels</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># å®šä¹‰ç¥ç»ç½‘ç»œæ¨¡å‹
</span><span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># è¾“å…¥å±‚ä¸º28x28å…±784ä¸ªå…ƒç´ çš„æ•°ç»„,èŠ‚ç‚¹1024ä¸ª
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">784</span><span class="p">,)),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">)</span>
<span class="p">])</span>
<span class="c1"># ç¼–è¯‘æ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span>
              <span class="n">loss</span><span class="o">=</span><span class="s">'sparse_categorical_crossentropy'</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>
<span class="c1"># ä½¿ç”¨è®­ç»ƒé›†æ•°æ®è®­ç»ƒæ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">mnist</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># æµ‹è¯•é›†çš„æ ‡ç­¾åŒæ ·è½¬æˆ0-9æ•°å­—
</span><span class="n">test_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mnist</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">labels</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># ä½¿ç”¨æµ‹è¯•é›†æ ·æœ¬éªŒè¯è¯†åˆ«å‡†ç¡®ç‡
</span><span class="n">test_loss</span><span class="p">,</span> <span class="n">test_acc</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">mnist</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">Test accuracy:'</span><span class="p">,</span> <span class="n">test_acc</span><span class="p">)</span>

<span class="c1"># å®Œæ•´é¢„æµ‹æµ‹è¯•é›†æ ·æœ¬
</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">mnist</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">images</span><span class="p">)</span>
<span class="c1"># å›¾ç¤ºç»“æœçš„å‰4*6ä¸ªæ ·æœ¬
</span><span class="n">show_images</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">mnist</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">images</span><span class="p">,</span> <span class="n">mnist</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
</code></pre></div></div>
<h4 id="ä»£ç è®²è§£">ä»£ç è®²è§£</h4>
<p>é€šå¸¸æˆ‘éƒ½æ˜¯ç›´æ¥åœ¨æ³¨é‡Šä¸­å¯¹ç¨‹åºåšä»”ç»†çš„è®²è§£ï¼Œè¿™æ¬¡ä¾‹å¤–ä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä»å¤§å±€è§‚ä¸Šçœ‹æ¸…æ¥šä»£ç çš„ç»“æ„ã€‚<br />
è¿™å‡ è¡Œä»£ç æ˜¯å®šä¹‰ç¥ç»ç½‘ç»œæ¨¡å‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å®šä¹‰ç¥ç»ç½‘ç»œæ¨¡å‹
</span><span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># è¾“å…¥å±‚ä¸º28x28å…±784ä¸ªå…ƒç´ çš„æ•°ç»„,èŠ‚ç‚¹1024ä¸ª
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">784</span><span class="p">,)),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div></div>
<p>æ¯ä¸€è¡Œå®é™…å°±ä»£è¡¨ä¸€å±‚ç¥ç»ç½‘ç»œçš„èŠ‚ç‚¹ã€‚åœ¨ç¬¬ä¸€è¡Œä¸­ç‰¹åˆ«æŒ‡æ˜äº†è¾“å…¥æ•°æ®çš„å½¢å¼ï¼Œå³å¯ä»¥æœ‰æœªçŸ¥æ•°é‡çš„æ ·æœ¬ï¼Œæ¯ä¸€ä¸ªæ ·æœ¬784ä¸ªå­—èŠ‚(28x28)ã€‚å®é™…ä¸Šè¿™ä¸ªè¾“å…¥æ ·æœ¬å¯ä»¥ä¸æŒ‡å®šå½¢çŠ¶ï¼Œåœ¨æ²¡æœ‰æŒ‡å®šçš„æƒ…å†µä¸‹ï¼ŒKerasä¼šè‡ªåŠ¨è¯†åˆ«è®­ç»ƒæ•°æ®é›†çš„å½¢çŠ¶ï¼Œå¹¶è‡ªåŠ¨å°†æ¨¡å‹è¾“å…¥åŒ¹é…åˆ°è®­ç»ƒé›†å½¢çŠ¶ã€‚åªæ˜¯è¿™ç§ä¹ æƒ¯å¹¶ä¸ä¸€å®šå¥½ï¼Œé™¤äº†æ•ˆç‡é—®é¢˜ï¼Œå½“æ ·æœ¬é›†å‡ºé”™çš„æ—¶å€™ï¼Œæ¨¡å‹çš„å®šä¹‰ä¹Ÿæ— æ³•å¸®åŠ©å¼€å‘è€…æå‰å‘ç°é—®é¢˜ã€‚æ‰€ä»¥å»ºè®®äº§å“åŒ–çš„æ¨¡å‹ï¼Œåº”å½“åœ¨æ¨¡å‹ä¸­æŒ‡å®šè¾“å…¥æ•°æ®ç±»å‹ã€‚<br />
é™¤äº†ç¬¬ä¸€å±‚ä¹‹å¤–ï¼Œä¹‹åçš„æ¯ä¸€å±‚éƒ½æ— éœ€æŒ‡å®šè¾“å…¥æ ·æœ¬å½¢çŠ¶ã€‚Kerasä¼šè‡ªåŠ¨åŒ¹é…ç›¸é‚»ä¸¤ä¸ªå±‚çš„æ•°æ®ã€‚è¿™èŠ‚çœäº†å¼€å‘äººå‘˜å¤§é‡çš„æ‰‹å·¥è®¡ç®—ä¹Ÿä¸æ˜“å‡ºé”™ã€‚<br />
æœ€åï¼Œæ¿€æ´»å‡½æ•°çš„é€‰æ‹©æˆä¸ºä¸€ä¸ªå‚æ•°ã€‚æ•´ä½“ä»£ç çœ‹ä¸Šå»ç®€æ´çš„ä»¤äººæƒŠè®¶ã€‚</p>

<p>æ¥ç€åœ¨ç¼–è¯‘æ¨¡å‹çš„ä»£ç ä¸­ï¼Œç›´æ¥æŒ‡å®šKerasä¸­é¢„å®šä¹‰çš„â€œsparse_categorical_crossentropyâ€æŸå¤±å‡½æ•°å’Œâ€œadamâ€ä¼˜åŒ–ç®—æ³•ã€‚ä¸€ä¸ªå‡½æ•°é…åˆå‡ ä¸ªå‚æ•°é€‰æ‹©å°±å®Œæˆäº†è¿™éƒ¨åˆ†å·¥ä½œï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ç¼–è¯‘æ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span>
              <span class="n">loss</span><span class="o">=</span><span class="s">'sparse_categorical_crossentropy'</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>
</code></pre></div></div>
<p>å¯¹åŸæœ¬å¤æ‚çš„è®­ç»ƒå¾ªç¯éƒ¨åˆ†ï¼ŒTensorFlow 2.0ä¼˜åŒ–çš„æœ€ä¸ºå½»åº•ï¼Œåªæœ‰ä¸€è¡Œä»£ç ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ä½¿ç”¨è®­ç»ƒé›†æ•°æ®è®­ç»ƒæ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">mnist</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>
<p>ä½¿ç”¨æµ‹è¯•é›†æ•°æ®å¯¹æ¨¡å‹è¿›è¡Œè¯„ä¼°åŒæ ·åªéœ€è¦ä¸€è¡Œä»£ç ï¼Œè¿™é‡Œå°±ä¸æ‘˜å‡ºæ¥äº†ï¼Œåœ¨ä¸Šé¢å®Œæ•´ä»£ç ä¸­èƒ½çœ‹åˆ°ã€‚<br />
å¯ä»¥æƒ³è±¡ï¼ŒTensorFlow 2.0æ­£å¼å‘å¸ƒåï¼Œæ¨¡å‹æ­å»ºã€è®­ç»ƒã€è¯„ä¼°çš„å·¥ä½œé‡å¤§å¹…å‡å°‘ï¼Œä¼šå‚¬ç”Ÿå¾ˆå¤šç”±å®éªŒæ€§æ¨¡å‹åˆ›æ–°è€Œå‡ºç°çš„æ–°ç®—æ³•ã€‚æœºå™¨å­¦ä¹ é¢†åŸŸä¼šå†æ¬¡æ¶Œç°æ™®åŠåŒ–æµªæ½®ã€‚<br />
è¿™ä¸€ç‰ˆä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿˜ç»†å¾®ä¿®æ”¹äº†æ ·æœ¬å¯è§†åŒ–éƒ¨åˆ†çš„ç¨‹åºï¼Œå°†åŸæ¥æ˜¾ç¤ºè®­ç»ƒé›†æ ·æœ¬ï¼Œæ”¹ä¸ºæ˜¾ç¤ºæµ‹è¯•é›†æ ·æœ¬ã€‚ä¸»è¦æ˜¯å¢åŠ äº†ä¸€ä¸ªå›¾ç‰‡è¯†åˆ«ç»“æœçš„å‚æ•°ã€‚å°†å›¾ç‰‡çš„è¯†åˆ«ç»“æœåŒæ•°æ®é›†çš„æ ‡æ³¨ä¸€åŒæ˜¾ç¤ºåœ¨å›¾ç‰‡çš„ä¸‹é¢ä½œä¸ºå¯¹æ¯”ã€‚<br />
ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 mnist-show-predict-pic-v1.py 
Extracting data/train-images-idx3-ubyte.gz
Extracting data/train-labels-idx1-ubyte.gz
Extracting data/t10k-images-idx3-ubyte.gz
Extracting data/t10k-labels-idx1-ubyte.gz
Epoch 1/3
55000/55000 <span class="o">[==============================]</span> - 17s 307us/sample - loss: 0.1869 - accuracy: 0.9420
Epoch 2/3
55000/55000 <span class="o">[==============================]</span> - 17s 304us/sample - loss: 0.0816 - accuracy: 0.9740
Epoch 3/3
55000/55000 <span class="o">[==============================]</span> - 16s 298us/sample - loss: 0.0557 - accuracy: 0.9821
10000/10000 <span class="o">[==============================]</span> - 1s 98us/sample - loss: 0.0890 - accuracy: 0.9743

Test accuracy: 0.9743
</code></pre></div></div>
<p>æœ€ç»ˆçš„ç»“æœè¡¨ç¤ºï¼Œæ¨¡å‹é€šè¿‡3æ¬¡çš„è®­ç»ƒè¿­ä»£ä¹‹åã€‚ä½¿ç”¨æµ‹è¯•é›†æ•°æ®è¿›è¡ŒéªŒè¯ï¼Œæ‰‹å†™ä½“æ•°å­—è¯†åˆ«æ­£ç¡®ç‡ä¸º97.43%ã€‚<br />
ç¨‹åºæœ€ç»ˆä¼šæ˜¾ç¤ºæµ‹è¯•é›†å‰24ä¸ªå›¾ç‰‡åŠé¢„æµ‹ç»“æœå’Œæ ‡æ³¨ä¿¡æ¯çš„å¯¹æ¯”ï¼š<br />
<img src="http://115.182.41.123/files/201904/tensorFlow2/mnist_predict_samples.png" alt="" /></p>

<p>ï¼ˆå¾…ç»­â€¦ï¼‰</p>

:ET