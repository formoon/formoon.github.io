I"ÿã<p><img src="/attachments/201904/tensorFlow2/tf-logo-card-2.png" alt="" /></p>
<h4 id="æ•°æ®é›†åŠé¢„å¤„ç†">æ•°æ®é›†åŠé¢„å¤„ç†</h4>
<p>ä»è¿™ä¸ªä¾‹å­å¼€å§‹ï¼Œç›¸å½“æ¯”ä¾‹çš„ä»£ç éƒ½æ¥è‡ªäº<a href="https://www.tensorflow.org/alpha/tutorials/quickstart/beginner">å®˜æ–¹æ–°ç‰ˆæ–‡æ¡£</a>çš„ç¤ºä¾‹ã€‚å¼€å§‹çš„å‡ ä¸ªè¿˜å¥½ï¼Œä½†éšåçš„ç¨‹åºéƒ½å°†éœ€è¦å¤§é‡çš„ç®—åŠ›æ”¯æŒã€‚Google Colabæ˜¯ä¸€ä¸ªéå¸¸æ£’çš„äº‘ç«¯å®éªŒå®¤ï¼Œæä¾›å«æœ‰TPU/GPUæ”¯æŒçš„Pythonæ‰§è¡Œç¯å¢ƒ(éœ€è¦åœ¨Editâ†’Notebook Settingsè®¾ç½®ä¸­æ‰“å¼€)ã€‚é€Ÿåº¦æ¯”ä¸ä¸Šé…ç½®ä¼˜è‰¯çš„æœ¬åœ°ç”µè„‘ï¼Œä½†è‡³å°‘è¶…è¿‡å¹³å‡çš„å¼€å‘ç¯å¢ƒã€‚<br />
æ‰€ä»¥å¦‚æœä½ çš„ç”µè„‘è¿è¡Œé€Ÿåº¦ä¸ç†æƒ³ï¼Œå»ºè®®ä½ å°è¯•å»å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œä½¿ç”¨ç›¸åº”ä»£ç çš„å¯¹åº”é“¾æ¥è¿›å…¥Colabæ‰§è¡Œè¯•ä¸€è¯•ã€‚<br />
<a href="https://colab.research.google.com/notebooks/welcome.ipynb#recent=true">Colab</a>è¿˜å…è®¸æ–°å»ºPythonç¬”è®°ï¼Œæ¥å°è¯•è‡ªå·±çš„å®éªŒä»£ç ã€‚å½“ç„¶è¿™ä¸€åˆ‡çš„å‰æï¼Œæ˜¯éœ€è¦ä½ ç§‘å­¦ä¸Šç½‘ã€‚</p>

<p>ä¸Šä¸€ä¸ªä¾‹å­å·²ç»å®Œå…¨ä½¿ç”¨äº†TensorFlow 2.0çš„åº“æ¥å®ç°ã€‚ä½†æ•°æ®é›†ä»ç„¶æ²¿ç”¨äº†TensorFlow 1.xè®²è§£æ—¶æ‰€ä½¿ç”¨çš„æ ·æœ¬ã€‚<br />
TensorFlow 2.0é»˜è®¤ä½¿ç”¨Kerasçš„datasetsç±»æ¥ç®¡ç†æ•°æ®é›†ï¼ŒåŒ…æ‹¬Keraså†…ç½®æ¨¡å‹å·²ç»è®­ç»ƒå¥½çš„ç”Ÿäº§æ•°æ®é›†ï¼Œå’Œç±»ä¼¼MNISTè¿™ç§å­¦ä¹ é¡¹ç›®æ‰€ç”¨åˆ°çš„ç»ƒä¹ æ•°æ®é›†ã€‚<br />
ä½¿ç”¨Kerasè½½å…¥æ•°æ®é›†åŒæ ·åªæ˜¯ä¸€è¡Œä»£ç ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">),</span> <span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">mnist</span><span class="p">.</span><span class="n">load_data</span><span class="p">()</span>
</code></pre></div></div>
<p>Keras.datasetsé»˜è®¤æ˜¯ä»è°·æ­Œç½‘ç«™ä¸‹è½½æ•°æ®é›†ï¼Œä»¥MNISTä¸ºä¾‹ï¼Œæ•°æ®ä¸‹è½½åœ°å€æ˜¯ï¼š<a href="https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz">https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz</a>ã€‚æ–‡ä»¶ä¸‹è½½ä¹‹åï¼Œæ”¾ç½®åˆ°<code class="language-plaintext highlighter-rouge">~/.keras/datasets</code>æ–‡ä»¶å¤¹ï¼Œä»¥åæ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ä»æœ¬åœ°è¯»å–æ•°æ®ã€‚æ•°æ®ä¿å­˜è·¯å¾„Linux/Macéƒ½æ˜¯å¦‚æ­¤ï¼ŒWindowsåŒæ ·æ˜¯åœ¨ç”¨æˆ·ä¸»ç›®å½•ï¼Œæ¯”å¦‚ï¼šc:\Users\Administrator.keras\datasetsã€‚</p>

<p>æ¥ç€æ˜¯æ•°æ®é¢„å¤„ç†çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯ä»åŸå§‹çš„å›¾ç‰‡ã€æ ‡æ³¨ï¼Œè½¬æ¢ä¸ºæœºå™¨å­¦ä¹ æ‰€éœ€è¦çš„è§„èŒƒåŒ–ä¹‹åçš„æ•°æ®ã€‚æˆ‘ä»¬åœ¨TensorFlow 1.xä¸­æ‰€ä½¿ç”¨çš„æ•°æ®å®é™…æ˜¯å·²ç»è§„èŒƒåŒ–ä¹‹åçš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Python3çš„äº¤äº’æ¨¡å¼ï¼Œè½½å…¥æ•°æ®ä¹‹åï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ•°æ®ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">python3</span>
<span class="n">Python</span> <span class="mf">3.7</span><span class="p">.</span><span class="mi">3</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">09</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">39</span><span class="p">)</span> 
<span class="p">[</span><span class="n">Clang</span> <span class="mf">10.0</span><span class="p">.</span><span class="mi">0</span> <span class="p">(</span><span class="n">clang</span><span class="o">-</span><span class="mf">1000.11</span><span class="p">.</span><span class="mf">45.5</span><span class="p">)]</span> <span class="n">on</span> <span class="n">darwin</span>
<span class="n">Type</span> <span class="s">"help"</span><span class="p">,</span> <span class="s">"copyright"</span><span class="p">,</span> <span class="s">"credits"</span> <span class="ow">or</span> <span class="s">"license"</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="p">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">input_data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s">"data/"</span><span class="p">,</span> <span class="n">one_hot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Extracting</span> <span class="n">data</span><span class="o">/</span><span class="n">train</span><span class="o">-</span><span class="n">images</span><span class="o">-</span><span class="n">idx3</span><span class="o">-</span><span class="n">ubyte</span><span class="p">.</span><span class="n">gz</span>
<span class="n">Extracting</span> <span class="n">data</span><span class="o">/</span><span class="n">train</span><span class="o">-</span><span class="n">labels</span><span class="o">-</span><span class="n">idx1</span><span class="o">-</span><span class="n">ubyte</span><span class="p">.</span><span class="n">gz</span>
<span class="n">Extracting</span> <span class="n">data</span><span class="o">/</span><span class="n">t10k</span><span class="o">-</span><span class="n">images</span><span class="o">-</span><span class="n">idx3</span><span class="o">-</span><span class="n">ubyte</span><span class="p">.</span><span class="n">gz</span>
<span class="n">Extracting</span> <span class="n">data</span><span class="o">/</span><span class="n">t10k</span><span class="o">-</span><span class="n">labels</span><span class="o">-</span><span class="n">idx1</span><span class="o">-</span><span class="n">ubyte</span><span class="p">.</span><span class="n">gz</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mnist</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">array</span><span class="p">([</span><span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span>
   <span class="p">...</span><span class="n">çœç•¥éƒ¨åˆ†</span><span class="p">...</span>
       <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span>
       <span class="mf">0.9215687</span> <span class="p">,</span> <span class="mf">0.9215687</span> <span class="p">,</span> <span class="mf">0.9215687</span> <span class="p">,</span> <span class="mf">0.9215687</span> <span class="p">,</span> <span class="mf">0.9215687</span> <span class="p">,</span>
       <span class="mf">0.9843138</span> <span class="p">,</span> <span class="mf">0.9843138</span> <span class="p">,</span> <span class="mf">0.9725491</span> <span class="p">,</span> <span class="mf">0.9960785</span> <span class="p">,</span> <span class="mf">0.9607844</span> <span class="p">,</span>
       <span class="mf">0.9215687</span> <span class="p">,</span> <span class="mf">0.74509805</span><span class="p">,</span> <span class="mf">0.08235294</span><span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span>
   <span class="p">...</span><span class="n">çœç•¥éƒ¨åˆ†</span><span class="p">...</span>
       <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span>
       <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mnist</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
</code></pre></div></div>
<p>å¯¹äºå›¾ï¼Œå°±æ˜¯28x28çš„äºŒç»´æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªæ•°æ®ï¼Œä»£è¡¨ä¸€ä¸ªç‚¹ï¼Œæ•°æ®çš„å€¼è¶Šæ¥è¿‘1ï¼Œä»£è¡¨è¿™ä¸ªç‚¹çš„é¢œè‰²è¶Šæ¥è¿‘ç™½è‰²ï¼›åä¹‹ï¼Œåˆ™é¢œè‰²è¶Šæ¥è¿‘é»‘è‰²ã€‚å€Ÿç”¨<a href="http://blog.17study.com.cn/2018/01/10/tensorFlow-series-4/">åŸæ–‡ç¬¬å››ç¯‡</a>ä¸­çš„ä¸€å¹…å›¾æ¥å¸®ä½ å›å¿†ä¸€ä¸‹è¿™ä¸ªå…³ç³»ï¼ˆä¸Šä¸€ç¯‡ä¸­ï¼Œå›¾ç‰‡æ˜¾ç¤ºéƒ¨åˆ†çš„ä»£ç ï¼ŒåŠŸèƒ½ä¹Ÿæ˜¯è¿˜åŸè¿™ç»„æ•°æ®ï¼‰ï¼š<br />
<img src="http://www.tensorfly.cn/tfdoc/images/MNIST-Matrix.png" alt="" /><br />
å¯¹äºæ ‡ç­¾ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯è¯†åˆ«ä¸º0-9å…±10ä¸ªæ•°å­—ï¼Œæ˜¯10ä¸ªè¾“å‡ºçš„åˆ†ç±»å™¨ã€‚æ‰€ä»¥æ ‡ç­¾ç»„æŸä¸€ä¸ªå€¼ä¸º1ï¼Œè¡¨ç¤ºå›¾åƒä»£è¡¨çš„æ‰‹å†™æ•°å­—å±äºè¯¥åˆ†ç±»ã€‚åŒæ ·å€Ÿç”¨ä¸€ä¸‹åŸå›¾ï¼š<br />
<img src="http://www.tensorfly.cn/tfdoc/images/mnist-train-ys.png" alt="" />
å¦‚æœæƒ³å°†è¿™æ ·çš„åˆ†ç±»æ•°æ®è½¬æˆæˆ‘ä»¬ä¹ æƒ¯çš„0-9æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨TensorFlowä¸­å†…ç½®çš„å‡½æ•°argmax:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="p">...</span><span class="n">æ¥ç€ä¸Šé¢çš„äº¤äº’æ¨¡å¼ç»§ç»­æ‰§è¡Œ</span><span class="p">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">train_labels</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mnist</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">labels</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">train_labels</span>
<span class="o">&lt;</span><span class="n">tf</span><span class="p">.</span><span class="n">Tensor</span><span class="p">:</span> <span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">55000</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">,</span> <span class="n">numpy</span><span class="o">=</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">...,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span><span class="o">&gt;</span>
</code></pre></div></div>
<p>ç°åœ¨çš„æ•°æ®çœ‹èµ·æ¥å¾ˆä¹ æƒ¯äº†å§ï¼Ÿæ›´å¹¸ç¦çš„æ˜¯ï¼Œä½¿ç”¨Kerasçš„çš„åˆ†ç±»å™¨æ¨¡å‹è®­ç»ƒï¼Œå·²ç»å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™æ ·çš„æ ‡ç­¾æ•°æ®äº†ã€‚<br />
keras.datasets.mnist.load_data()æ‰€è½½å…¥çš„æ ·æœ¬æ•°æ®ï¼Œè·ŸTensorFlow 1.0æ‰€ä½¿ç”¨çš„æ•°æ®æœ‰ä¸€äº›åŒºåˆ«ã€‚å…¶ä¸­çš„å›¾åƒæ•°æ®å¹¶æœªåšè§„èŒƒåŒ–ï¼Œä»ç„¶æ˜¯é€šå¸¸BMPå›¾åƒä¸­çš„0-255çš„å­—èŠ‚æ•°æ®æ–¹å¼ã€‚æ ‡ç­¾æ•°æ®ï¼Œä¹Ÿç›´æ¥æ˜¯æˆ‘ä»¬æ›´ç†Ÿæ‚‰çš„0-9æ•°å­—æ ‡ç­¾ã€‚è¿™ä¸¤ä¸ªå¾®å°çš„å˜åŒ–æç°äº†TensorFlowç†å¿µçš„è½¬å˜ï¼ŒTensorFlowæ›´è´´è¿‘çœŸå®çš„å·¥ä½œç¯å¢ƒäº†ã€‚<br />
æˆ‘ä»¬åŒæ ·åœ¨äº¤äº’æ¨¡å¼æ¥çœ‹ä¸€ä¸‹è¿™ä¸¤ç»„æ•°æ®ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">python3</span>
<span class="n">Python</span> <span class="mf">3.7</span><span class="p">.</span><span class="mi">3</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">09</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">39</span><span class="p">)</span> 
<span class="p">[</span><span class="n">Clang</span> <span class="mf">10.0</span><span class="p">.</span><span class="mi">0</span> <span class="p">(</span><span class="n">clang</span><span class="o">-</span><span class="mf">1000.11</span><span class="p">.</span><span class="mf">45.5</span><span class="p">)]</span> <span class="n">on</span> <span class="n">darwin</span>
<span class="n">Type</span> <span class="s">"help"</span><span class="p">,</span> <span class="s">"copyright"</span><span class="p">,</span> <span class="s">"credits"</span> <span class="ow">or</span> <span class="s">"license"</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="p">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">),</span> <span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">mnist</span><span class="p">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">train_images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">array</span><span class="p">([[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
   <span class="p">...</span><span class="n">çœç•¥éƒ¨åˆ†</span><span class="p">...</span>
       <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">30</span><span class="p">,</span>  <span class="mi">36</span><span class="p">,</span>  <span class="mi">94</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span>
        <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span>  <span class="mi">64</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">49</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span>
        <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span>  <span class="mi">93</span><span class="p">,</span>  <span class="mi">82</span><span class="p">,</span>  <span class="mi">82</span><span class="p">,</span>  <span class="mi">56</span><span class="p">,</span>  <span class="mi">39</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">18</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span>
        <span class="mi">253</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">80</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span>
        <span class="mi">205</span><span class="p">,</span>  <span class="mi">11</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">43</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">14</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span>
         <span class="mi">90</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>
   <span class="p">...</span><span class="n">çœç•¥éƒ¨åˆ†</span><span class="p">...</span>
       <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">uint8</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">train_labels</span>
<span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">...,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">uint8</span><span class="p">)</span>
</code></pre></div></div>
<p>å°±åƒä»ä¸Šä¸€ä¸ªç³»åˆ—ä¸­æˆ‘å°±ä¸€ç›´å¼ºè°ƒçš„ï¼ŒTensorFlowçš„ä½¿ç”¨è¶Šæ¥è¶Šå®¹æ˜“ï¼Œæˆç†Ÿçš„æ¨¡å‹è¶Šæ¥è¶Šå¤šã€‚éš¾åº¦æ›´å¤šçš„ä¼šé›†ä¸­åœ¨æ ·æœ¬çš„é€‰å–å’Œé¢„å¤„ç†ï¼Œæ‰€ä»¥ä¸€å®šè¦å¤šå…³æ³¨å¯¹åŸå§‹æ•°æ®çš„ç†è§£ã€‚<br />
TensorFlow 2.0å¯ä»¥ç›´æ¥å¤„ç†å¦‚ä¸Šæ‰€ç¤ºçš„æ ‡ç­¾æ•°æ®ã€‚å›¾åƒçš„æ•°æ®åˆ™ä»ç„¶éœ€è¦è§„èŒƒåŒ–ï¼Œå›¾åƒæ•°æ®çš„å–å€¼èŒƒå›´æˆ‘ä»¬å¾ˆæ¸…æ¥šæ˜¯0-255ï¼Œè§„èŒƒåŒ–ä¹Ÿå¾ˆç®€å•ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># æ•°æ®è§„èŒƒåŒ–ä¸º0-1èŒƒå›´çš„æµ®ç‚¹æ•°
</span><span class="n">train_images</span> <span class="o">=</span> <span class="n">train_images</span> <span class="o">/</span> <span class="mf">255.0</span>
<span class="n">test_images1</span> <span class="o">=</span> <span class="n">test_images</span> <span class="o">/</span> <span class="mf">255.0</span>
</code></pre></div></div>
<p>ä¸‹é¢çœ‹çœ‹å®Œæ•´çš„ä»£ç ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="c1"># tensorflowåº“
</span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="c1"># tensorflow å·²ç»å†…ç½®äº†keras
</span><span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>

<span class="c1"># å¼•å…¥ç»˜å›¾åº“
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># ç¬¬ä¸€æ¬¡ä½¿ç”¨ä¼šè‡ªåŠ¨ä»ç½‘ä¸Šä¸‹è½½mnistçš„è®­ç»ƒæ ·æœ¬
</span><span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">),</span> <span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">mnist</span><span class="p">.</span><span class="n">load_data</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">imgs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">):</span>
	<span class="c1"># TensorFlow 2.xçš„æ•°æ®å·²ç»æ˜¯0-255èŒƒå›´ï¼Œæ— éœ€å†æ¬¡è¿˜åŸ
</span>    <span class="n">image</span> <span class="o">=</span> <span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="c1"># ç»˜åˆ¶æ ·æœ¬å›¾
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="c1"># æ˜¾ç¤ºæ ‡ç­¾å€¼ï¼Œå¯¹æ¯”æ˜¾ç¤ºé¢„æµ‹å€¼å’Œå®é™…æ ‡ç­¾å€¼
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"predict:{} label:{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">show_samples</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">):</span>
    <span class="n">num_images</span> <span class="o">=</span> <span class="n">num_rows</span><span class="o">*</span><span class="n">num_cols</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="s">'Predict Samples'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_cols</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">num_rows</span><span class="p">))</span>
    <span class="c1"># å¾ªç¯æ˜¾ç¤ºå‰num_rows*num_colså‰¯æ ·æœ¬å›¾ç‰‡
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">):</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># æ•°æ®è§„èŒƒåŒ–ä¸º0-1èŒƒå›´çš„æµ®ç‚¹æ•°
</span><span class="n">train_images</span> <span class="o">=</span> <span class="n">train_images</span> <span class="o">/</span> <span class="mf">255.0</span>
<span class="n">test_images1</span> <span class="o">=</span> <span class="n">test_images</span> <span class="o">/</span> <span class="mf">255.0</span>

<span class="c1"># å®šä¹‰ç¥ç»ç½‘ç»œæ¨¡å‹
</span><span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># è¾“å…¥å±‚æŠŠ28x28çš„2ç»´çŸ©é˜µè½¬æ¢æˆ1ç»´
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">)</span>
<span class="p">])</span>
<span class="c1"># ç¼–è¯‘æ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span> 
              <span class="n">loss</span><span class="o">=</span><span class="s">'sparse_categorical_crossentropy'</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>
<span class="c1"># ä½¿ç”¨è®­ç»ƒé›†æ•°æ®è®­ç»ƒæ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨æµ‹è¯•é›†æ ·æœ¬éªŒè¯è¯†åˆ«å‡†ç¡®ç‡
</span><span class="n">test_loss</span><span class="p">,</span> <span class="n">test_acc</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_images1</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">Test accuracy:'</span><span class="p">,</span> <span class="n">test_acc</span><span class="p">)</span>

<span class="c1"># å®Œæ•´é¢„æµ‹æµ‹è¯•é›†æ ·æœ¬
</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_images1</span><span class="p">)</span>

<span class="c1"># æ˜¾ç¤ºæµ‹è¯•æ ·æœ¬é¢„æµ‹ç»“æœ
</span><span class="n">show_samples</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
</code></pre></div></div>
<p>ä»£ç ä¸­ï¼Œå›¾ç‰‡æ˜¾ç¤ºçš„éƒ¨åˆ†ä¹Ÿå¯¹åº”å–æ¶ˆäº†æŠŠè§„èŒƒåŒ–çš„æ•°æ®è¿˜åŸä¸º0-255åŸå§‹å›¾åƒæ•°æ®çš„è¿‡ç¨‹ã€‚å…¶å®ƒéƒ¨åˆ†åˆ™å¹¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚<br />
ç°åœ¨ï¼ŒMNISTå·²ç»æ˜¯å®Œæ•´çš„TensorFlow 2.0çš„åŸç”Ÿä»£ç äº†ã€‚ç»•äº†è¿™ä¹ˆè¿œï¼Œå¸Œæœ›èƒ½å¸®ä½ æ›´æ·±åˆ»ç†è§£è¿™äº›ä»£ç èƒŒåçš„å·¥ä½œã€‚</p>

<h4 id="å·ç§¯å’Œæ± åŒ–">å·ç§¯å’Œæ± åŒ–</h4>
<p>åœ¨å‰ä¸€ä¸ªç³»åˆ—ä¸­ï¼Œå·ç§¯å’Œæ± åŒ–éƒ¨åˆ†æ®å¾ˆå¤šåé¦ˆè¯´æ˜¯ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—¨æ§›ã€‚æœ‰è¯»è€…è¯´å®Œå…¨ç®—ä¸æ¸…æ¯ä¸€å±‚å’Œç›¸è¿æ¥çš„å±‚ä¹‹é—´çš„æ•°æ®å…³ç³»ã€‚<br />
åœ¨TensorFlow 2.0ä¸­ï¼Œå°±åƒå‰é¢è¯´è¿‡çš„ï¼Œè¿™ç§å±‚ä¸å±‚ä¹‹é—´çš„æ•°æ®ç»´åº¦æ¨¡å‹å®Œå…¨æ˜¯æ— éœ€è‡ªå·±è®¡ç®—çš„ï¼ŒKerasä¼šè‡ªåŠ¨åŒ¹é…è¿™ç§æ•°æ®å…³ç³»ã€‚å› æ­¤å•çº¯ä»è¿™ä¸€ç‚¹ä¸Šè¯´ï¼Œåœ¨TensorFlow 2.0ä¸­ï¼Œæ— è®ºå¤šå¤æ‚çš„æ¨¡å‹æ„å»ºéƒ½ä¸ä¼šå†æˆä¸ºé—®é¢˜ã€‚åªæ˜¯ä¼šå¤šä¸€ç‚¹å…¶å®ƒçš„æ‹…å¿ƒï¼Œé‚£å°±æ˜¯è¿™æ ·éšè—èµ·æ¥æœºå™¨å­¦ä¹ æœ¬è´¨ä¸Šçš„æ•°å­¦æ¨¡å‹ï¼Œç©¶ç«Ÿå¯¹ç¨‹åºå‘˜æ¥è¯´æ˜¯å¥½äº‹è¿˜æ˜¯åäº‹ï¼Ÿ<br />
TensorFlow 1.xä¸­ä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œè§£å†³MNISTé—®é¢˜çš„è®²è§£åœ¨<a href="http://blog.17study.com.cn/2018/01/11/tensorFlow-series-6/">å‰ç³»åˆ—ç¬¬å…­ç¯‡</a>ã€‚ç¯‡å¹…å¾ˆé•¿ï¼Œè¿™é‡Œå°±ä¸é‡è´´äº†ã€‚åœ¨TensorFlow 2.0ä¸­ï¼Œåˆ™åªæ˜¯ä¸€ä¸ªå‡½æ•°å‡ è¡Œä»£ç (è¯·å°½é‡è·ŸTensorFlow 1.xç‰ˆæœ¬çš„ä»£ç å¯¹åº”ç€çœ‹ã€‚å¯¹å·ç§¯ã€æ± åŒ–çš„æ¦‚å¿µå·²ç»å¿˜è®°çš„ä¹Ÿå¼ºçƒˆå»ºè®®å»å‰ç³»åˆ—å¤ä¹ ä¸€ä¸‹)ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å®šä¹‰å·ç§¯æ± åŒ–ç¥ç»ç½‘ç»œæ¨¡å‹
</span><span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                              <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                              <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Flatten</span><span class="p">(),</span>  <span class="c1"># ä¸‹é¢çš„ç¥ç»ç½‘ç»œéœ€è¦1ç»´çš„æ•°æ®
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div></div>
<p>Kerasè®©æ¨¡å‹æ„å»ºçš„è¿‡ç¨‹å˜å¾—æå…¶å®¹æ˜“ã€‚<br />
ä»åŸç†ä¸Šè¯´ï¼Œå·ç§¯æ˜¯å¯¹å›¾åƒçš„äºŒç»´æ•°æ®åšæ‰«æï¼Œè¿˜éœ€è¦æŒ‡å®šå›¾åƒçš„è‰²æ·±ã€‚æ‰€ä»¥åœ¨æ ·æœ¬é¢„å¤„ç†çš„é˜¶æ®µï¼Œæˆ‘ä»¬è¿˜è¦å¯¹å…¶åšä¸€ä¸ªå˜å½¢ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å·ç§¯éœ€è¦2ç»´æ•°æ®ï¼Œè¿˜éœ€è¦æŒ‡å®šè‰²æ·±ï¼Œå› æ­¤æ˜¯ï¼ˆæ ·æœ¬æ•°ï¼Œé•¿ï¼Œå®½ï¼Œè‰²æ·±ï¼‰
</span><span class="n">train_images</span> <span class="o">=</span> <span class="n">train_images</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">train_labels</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_images1</span> <span class="o">=</span> <span class="n">test_images1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">test_labels</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<p>è®­ç»ƒé›†çš„æ ·æœ¬æˆ‘ä»¬ç›´æ¥ç”¨å˜å½¢åçš„æ•°æ®æ›¿ä»£äº†åŸå§‹æ ·æœ¬ã€‚æµ‹è¯•é›†åˆ™å¦å¤–ä½¿ç”¨äº†ä¸€ä¸ªå˜é‡ä¿ç•™äº†åŸå§‹çš„æµ‹è¯•é›†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¾ç¤ºæµ‹è¯•é›†å›¾ç‰‡çš„æ—¶å€™ï¼Œä½¿ç”¨åŸå§‹æ•°æ®é›†æ˜¾ç„¶æ›´æ–¹ä¾¿ã€‚<br />
å®é™…ä¸Šæ•´ä¸ªä»£ç åªæœ‰è¿™ä¹ˆä¸¤ç‚¹åŒºåˆ«ï¼Œä¸è¿‡ä¸ºäº†ä½ ç»ƒä¹ çš„æ—¶å€™æ–¹ä¾¿ï¼Œè¿˜æ˜¯æŠŠå®Œæ•´ä»£ç è´´ä¸€éï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="c1"># tensorflowåº“
</span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="c1"># tensorflow å·²ç»å†…ç½®äº†keras
</span><span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>

<span class="c1"># å¼•å…¥ç»˜å›¾åº“
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># ç¬¬ä¸€æ¬¡ä½¿ç”¨ä¼šè‡ªåŠ¨ä»ç½‘ä¸Šä¸‹è½½mnistçš„è®­ç»ƒæ ·æœ¬
</span><span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">),</span> <span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">mnist</span><span class="p">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="c1"># æ•°æ®è·¯å¾„ï¼š~/.keras/datasets/mnist.npz
</span>

<span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">imgs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="c1"># ç»˜åˆ¶æ ·æœ¬å›¾
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="c1"># æ˜¾ç¤ºæ ‡ç­¾å€¼
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"predict:{} label:{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">show_samples</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">):</span>
    <span class="n">num_images</span> <span class="o">=</span> <span class="n">num_rows</span><span class="o">*</span><span class="n">num_cols</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="s">'Predict Samples'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_cols</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">num_rows</span><span class="p">))</span>
    <span class="c1"># å¾ªç¯æ˜¾ç¤ºå‰4*6å‰¯è®­ç»ƒé›†æ ·æœ¬å›¾ç‰‡
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">):</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># æ•°æ®è§„èŒƒåŒ–ä¸º0-1èŒƒå›´çš„æµ®ç‚¹æ•°
</span><span class="n">train_images</span> <span class="o">=</span> <span class="n">train_images</span> <span class="o">/</span> <span class="mf">255.0</span>
<span class="n">test_images1</span> <span class="o">=</span> <span class="n">test_images</span> <span class="o">/</span> <span class="mf">255.0</span>

<span class="c1"># å·ç§¯éœ€è¦2ç»´æ•°æ®ï¼Œè¿˜éœ€è¦æŒ‡å®šè‰²æ·±ï¼Œå› æ­¤æ˜¯ï¼ˆæ ·æœ¬æ•°ï¼Œé•¿ï¼Œå®½ï¼Œè‰²æ·±ï¼‰
</span><span class="n">train_images</span> <span class="o">=</span> <span class="n">train_images</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">train_labels</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_images1</span> <span class="o">=</span> <span class="n">test_images1</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">test_labels</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># å®šä¹‰å·ç§¯æ± åŒ–ç¥ç»ç½‘ç»œæ¨¡å‹
</span><span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                              <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                              <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Flatten</span><span class="p">(),</span>  <span class="c1"># ä¸‹é¢çš„ç¥ç»ç½‘ç»œéœ€è¦1ç»´çš„æ•°æ®
</span>    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">)</span>
<span class="p">])</span>
<span class="c1"># ç¼–è¯‘æ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span> 
              <span class="n">loss</span><span class="o">=</span><span class="s">'sparse_categorical_crossentropy'</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>
<span class="c1"># ä½¿ç”¨è®­ç»ƒé›†æ•°æ®è®­ç»ƒæ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨æµ‹è¯•é›†æ ·æœ¬éªŒè¯è¯†åˆ«å‡†ç¡®ç‡
</span><span class="n">test_loss</span><span class="p">,</span> <span class="n">test_acc</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_images1</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">Test accuracy:'</span><span class="p">,</span> <span class="n">test_acc</span><span class="p">)</span>

<span class="c1"># å®Œæ•´é¢„æµ‹æµ‹è¯•é›†æ ·æœ¬
</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_images1</span><span class="p">)</span>

<span class="c1"># æ˜¾ç¤ºæµ‹è¯•æ ·æœ¬é¢„æµ‹ç»“æœ
</span><span class="n">show_samples</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

</code></pre></div></div>
<p>ç¨‹åºæ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æ§åˆ¶å°çš„è¾“å‡ºä¿¡æ¯ç±»ä¼¼ä¸‹é¢ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">chmod</span> +x mnist-conv-maxpool-v2.py
<span class="nv">$ </span>./mnist-conv-maxpool-v2.py
Epoch 1/3
60000/60000 <span class="o">[==============================]</span> - 141s 2ms/sample - loss: 0.1139 - accuracy: 0.9643
Epoch 2/3
60000/60000 <span class="o">[==============================]</span> - 143s 2ms/sample - loss: 0.0417 - accuracy: 0.9869
Epoch 3/3
60000/60000 <span class="o">[==============================]</span> - 138s 2ms/sample - loss: 0.0312 - accuracy: 0.9904
10000/10000 <span class="o">[==============================]</span> - 7s 659us/sample - loss: 0.0289 - accuracy: 0.9903

Test accuracy: 0.9903
</code></pre></div></div>
<p>åœ¨æ ·æœ¬é›†çš„æµ‹è¯•ä¸Šï¼Œå·ç§¯ç¥ç»ç½‘ç»œçš„ç‰ˆæœ¬å¯ä»¥è¾¾åˆ°è¶…è¿‡99%çš„æ­£ç¡®ç‡ã€‚<br />
è¿™ä¸ªæ­£ç¡®ç‡ï¼Œåªè¿›è¡Œäº†3æ¬¡çš„è®­ç»ƒè¿­ä»£ï¼Œå½“ç„¶å› ä¸ºå·ç§¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„å¤æ‚ï¼Œè¿™3æ¬¡çš„è®­ç»ƒå°±è¿œè¿œæ¯”ä¸Šä¸€ä¾‹ä¸­çš„5æ¬¡è®­ç»ƒé€Ÿåº¦æ›´æ…¢ã€‚</p>

<p>ï¼ˆå¾…ç»­â€¦ï¼‰</p>

:ET