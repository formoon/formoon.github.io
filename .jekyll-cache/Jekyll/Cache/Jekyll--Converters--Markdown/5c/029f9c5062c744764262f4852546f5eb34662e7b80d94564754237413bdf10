I" ,<p><img src="https://raw.githubusercontent.com/formoon/formoon.github.io/master/attachments/201912/wood-crate.jpg" alt="" /><br />
ä¸çŸ¥é“ä½ çš„ä½“ä¼šæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»Cåˆ‡æ¢åˆ°Rustä»¥æ¥ï¼Œæœ€å¤§çš„æ„Ÿå—å¹¶ä¸æ˜¯è¯­æ³•æ–¹é¢çš„â€”é‚£äº›æ–¹é¢å·²ç»æœ‰è¶³å¤Ÿå¤šäººæŠ±æ€¨è€Œåˆäº«å—ç€äº†ã€‚æˆ‘æœ€å¤§çš„æ„Ÿå—æ˜¯ç»ˆäºæŠŠWebç¼–ç¨‹å·¥å…·ï¼ŒåŒç³»ç»Ÿç¼–ç¨‹å·¥å…·ç»Ÿä¸€äº†èµ·æ¥ã€‚<br />
C/C++å…¶å®ä¹Ÿæœ‰å¾ˆå¤šä¸é”™çš„Webç¼–ç¨‹æ¡†æ¶ï¼Œåªæ˜¯ä¾ç„¶æ€»æ„Ÿè§‰å‘³é“ä¸å¯¹ã€‚æ‰€ä»¥å¹³å¸¸Node.Js / Golang /Pythonéƒ½ä¼šç©¿æ’åœ¨å·¥ä½œä¸­ã€‚æ— è®ºæ˜¯å¼€å‘æ•ˆç‡ï¼Œè¿˜æ˜¯ç»´æŠ¤çš„æ–¹ä¾¿ç¨‹åº¦ï¼ŒC/C++åœ¨Webå¼€å‘æ–¹é¢è¿˜æ˜¯å¼±é¡¹ã€‚</p>

<p>Rustè®©è¿™ç§æƒ…å†µå½»åº•æ”¹è§‚ã€‚Rustæœ¬èº«åœ¨ç³»ç»Ÿå¼€å‘æ–¹é¢å°±æœ‰ä¸é”™çš„è¡¨ç°ï¼Œç¤¾åŒºä¸­åˆå‡ºç°äº†ä¸å°‘ä¼˜ç§€çš„å¼€æºæ¡†æ¶æä¾›Webç¼–ç¨‹æ”¯æŒã€‚<br />
è¿™å…¶ä¸­è€ç‰Œçš„Actixå’Œæ–°ç§€Rocketæ˜¯ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸¤ä¸ªã€‚ä¸ªäººå…¶å®ç”¨Actixå¤šä¸€äº›ï¼Œæ¯•ç«Ÿå‡ºæ¥æ—¶é—´é•¿ï¼Œæ€§èƒ½è¯„æµ‹å¾—åˆ†åˆæ¯”è¾ƒé«˜ï¼Œç¤¾åŒºè¿˜æœ‰æ¯”è¾ƒå¥½çš„æ”¯æŒã€‚æ¯”å¦‚è§£å†³MultiPart FormDataä¸Šä¼ å·²ç»æœ‰äº†å¥½ç”¨çš„å·¥å…·ç®±awmpã€‚<br />
ä½†ä½œä¸ºä¸‡å¹´ä¸å˜çš„ä¹™æ–¹ä»£è¡¨ï¼Œå¾ˆå¤šæ—¶å€™å¯¹äºå¼€å‘ç¯å¢ƒçš„é€‰æ‹©è¿˜æ˜¯åšä¸åˆ°å®Œå…¨è‡ªä¸»ã€‚Rocketä¹Ÿæ˜¯ä¸æ—¶çš„ä¼šç”¨ä¸€ä¸‹ï¼ŒRocketæ˜“ç”¨æ€§æ›´å¥½ï¼Œä¸Šæ‰‹å®¹æ˜“ã€‚å¯¹äºæ–‡ä»¶ä¸Šä¼ ï¼Œå·¥å…·æœ¬èº«ä¹Ÿæä¾›äº†ä¸€äº›ç²—ç³™çš„æ”¯æŒï¼Œä½†è·Ÿawmpæ¯”è¿˜æ˜¯å·®äº†å¾ˆå¤šã€‚</p>

<p>åœ¨å¯¹ç½‘ä¸Šå„ç§èµ„æºä»”ç»†æœç´¢å¯»æ‰¾ä¹‹åï¼Œå†³å®šè¿˜æ˜¯è‡ªå·±æ¥å†™ä¸€ä¸ªï¼Œè¿™å°±æ˜¯ä»Šå¤©çš„rocket_uploadã€‚</p>

<p>å·¥å…·èƒŒååšäº†å¾ˆå¤šäº‹æƒ…æ¥è§£æMultiPart FormData, ä½†ç”¨èµ·æ¥è¿˜æ˜¯éå¸¸å®¹æ˜“ã€‚<br />
è¦åšçš„äº‹æƒ…åªæœ‰ä¸‰ä¸ªï¼Œé¦–å…ˆï¼Œåœ¨Cargo.tomlæ–‡ä»¶ä¸­åŠ å…¥rocket-uploadä¾èµ–ï¼š</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rocket_upload</span> <span class="o">=</span> <span class="s">"*"</span>
</code></pre></div></div>
<p>ç¬¬äºŒï¼Œæ˜¯åœ¨ç¨‹åºä¸€å¼€å§‹å¯¹rocket_uploadåšå¼•ç”¨ï¼š</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">rocket_upload</span><span class="p">::</span><span class="n">MultipartDatas</span><span class="p">;</span>
</code></pre></div></div>
<p>æœ€åï¼Œåˆ™æ˜¯åœ¨è¯·æ±‚å¤„ç†å‡½æ•°ä¸­ä½¿ç”¨äº†ï¼Œæ¥çœ‹ä»£ç ï¼š</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[post(</span><span class="s">"/upload/&lt;userid&gt;"</span><span class="nd">,</span> <span class="nd">data</span> <span class="nd">=</span> <span class="s">"&lt;data&gt;"</span><span class="nd">)]</span>
<span class="k">fn</span> <span class="nf">upload</span><span class="p">(</span><span class="n">userid</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">content_type</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">MultipartDatas</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Html</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span>
<span class="p">{</span>
  <span class="c">// è·å–åœ¨è·¯å¾„ä¸­åµŒå…¥çš„ç”¨æˆ·å‚æ•°ï¼Œåªæ˜¯æ¼”ç¤ºåŒåŸæœ‰ç³»ç»Ÿä¹‹é—´çš„å…¼å®¹æ€§ï¼Œæ— å®é™…æ„ä¹‰</span>
  <span class="k">let</span> <span class="k">mut</span> <span class="n">result</span><span class="o">=</span><span class="nd">format!</span><span class="p">(</span><span class="s">"UserID:{}&lt;br&gt;"</span><span class="p">,</span><span class="n">userid</span><span class="p">);</span>
  <span class="c">// content_typeåœ¨è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨ï¼Œæ‰€ä»¥å®é™…å¯ä»¥åœ¨å‡½æ•°å£°æ˜ä¸­å–æ¶ˆè¿™ä¸ªå˜é‡ï¼Œä½†å¦‚æœæƒ³äº†è§£MultiPartçš„æ›´å¤šä¿¡æ¯ï¼Œè¿˜æ˜¯å¯ä»¥ç”¨</span>
  <span class="n">result</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{}{:?}&lt;br&gt;"</span><span class="p">,</span><span class="n">result</span><span class="p">,</span><span class="n">content_type</span><span class="p">);</span>
  <span class="c">// è·å–ç”¨æˆ·ç½‘é¡µè¡¨å•ä¸­å…¶å®ƒçš„å­—æ®µå€¼</span>
  <span class="k">for</span> <span class="n">t</span> <span class="n">in</span> <span class="n">data</span><span class="py">.texts</span> <span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{}FieldName:{} --- FieldValue:{}&lt;br&gt;"</span><span class="p">,</span><span class="n">result</span><span class="p">,</span><span class="n">t</span><span class="py">.key</span><span class="p">,</span><span class="n">t</span><span class="py">.value</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c">// è·å–ç”¨æˆ·è¡¨å•ä¸­ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ”¯æŒå¤šä¸ªæ–‡ä»¶çš„ä¸Šä¼ </span>
  <span class="k">for</span> <span class="n">f</span> <span class="n">in</span> <span class="n">data</span><span class="py">.files</span> <span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{}FieldName:{} --- FileName:{} --- StoragePath:{}&lt;br&gt;"</span><span class="p">,</span>
      <span class="n">result</span><span class="p">,</span><span class="n">f</span><span class="py">.name</span><span class="p">,</span><span class="n">f</span><span class="py">.filename</span><span class="p">,</span><span class="n">f</span><span class="py">.path</span><span class="p">);</span>
    <span class="c">// æ–‡ä»¶åœ¨rocket-uploadå¤„ç†åï¼Œä¼šä¿å­˜åœ¨/tmpç›®å½•ï¼Œä¸‹é¢çš„å‘½ä»¤æŠŠæ–‡ä»¶æ‹·è´åˆ°è‡ªå·±å®šä¹‰çš„ä¸Šä¼ æ–‡ä»¶å¤¹</span>
    <span class="n">f</span><span class="nf">.persist</span><span class="p">(</span><span class="nn">Path</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="s">"upload"</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="c">// åœ¨åé¦ˆçš„ç½‘é¡µä¸­æ˜¾ç¤ºæ‰€æœ‰è·å–åˆ°çš„æ•°æ®ä¿¡æ¯</span>
  <span class="nf">Html</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;upload coming...&lt;br&gt;{}&lt;/body&gt;&lt;/html&gt;"</span><span class="p">,</span><span class="n">result</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å°±æˆ‘å½“å‰æ‰¾éå…¨ç½‘çš„ç»å†æ¥çœ‹ï¼Œè¿™ç®—æœ€ç®€å•çš„MultiPartå¤„ç†å·¥å…·äº†å§ã€‚<br />
å¯¹åº”çš„ï¼ŒæŠŠç½‘é¡µè¡¨å•çš„ä»£ç ä¹Ÿè´´å‡ºæ¥å¯¹æ¯”æ¥çœ‹ä¸€ä¸‹ï¼š</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge,chrome=1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"content-type"</span> <span class="na">content=</span><span class="s">"text/html;charset=utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">"always"</span> <span class="na">name=</span><span class="s">"referrer"</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>upload<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;body</span> <span class="na">link=</span><span class="s">"#0000cc"</span> <span class="na">style=</span><span class="s">""</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"data"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"/upload/334445566"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
              name:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;br/&gt;</span>
              information:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"info"</span><span class="nt">&gt;&lt;br/&gt;</span>
              Select files wanna upload , and click at "UPLOAD" button.<span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;br/&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"files"</span> <span class="na">multiple</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"UPLOAD"</span><span class="nt">&gt;</span>UPLOAD<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>ç®€å•æ¥è¯´ï¼Œåœ¨è¯·æ±‚å¤„ç†å‡½æ•°ä¸­ï¼ŒåŸæœ‰Restfulé£æ ¼ï¼Œåœ¨URLä¸­åµŒå…¥çš„å˜é‡ï¼Œä»ç„¶é‡‡ç”¨RocketåŸæœ‰çš„æ–¹å¼æ¥å£°æ˜å’Œå¤„ç†ã€‚<br />
éšåæ˜¯MultipartDatasç±»å‹çš„å˜é‡ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯<code class="language-plaintext highlighter-rouge">data</code>ã€‚<br />
å˜é‡ç»“æ„ç±»å‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œæˆå‘˜<code class="language-plaintext highlighter-rouge">texts</code>ä¸­åŒ…å«è¡¨å•ä¸­é™¤ä¸Šä¼ æ–‡ä»¶ä¹‹å¤–çš„å­—æ®µï¼Œå­—æ®µåç§°ä¿å­˜åœ¨keyæˆå‘˜å˜é‡ä¸­ï¼Œå€¼ä¿å­˜åœ¨valueæˆå‘˜å˜é‡ä¸­ã€‚<br />
<code class="language-plaintext highlighter-rouge">files</code>åˆ™åŒ…å«è¡¨å•ä¸­ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œé‚£å°±æ˜¯files[0]ã€‚è¡¨å•å­—æ®µåç§°ä¿å­˜åœ¨nameæˆå‘˜ï¼Œå•ç‹¬çš„æ–‡ä»¶åï¼Œä¹Ÿå°±æ˜¯æ¥è‡ªäºMultiPartæ•°æ®ä¸­çš„ï¼Œä¿å­˜åœ¨æˆå‘˜filenameï¼Œç¼“å­˜æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ä¿å­˜åœ¨pathæˆå‘˜ã€‚<br />
å› ä¸ºç¼“å­˜çš„æ–‡ä»¶åœ¨è¯·æ±‚å¤„ç†å‡½æ•°å®Œæˆåå°±è¶…å‡ºäº†ä½œç”¨åŸŸï¼Œä»è€Œè¢«è‡ªåŠ¨åˆ é™¤ã€‚æ‰€ä»¥å¦‚æœæƒ³æŠŠæ–‡ä»¶é•¿ä¹…ä¿å­˜ä¸‹æ¥ï¼Œå¯ä»¥è‡ªå·±å»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹æ¯”å¦‚uploadï¼Œç„¶åä½¿ç”¨<code class="language-plaintext highlighter-rouge">f.persist(Path::new("upload"));</code>æŠŠæ–‡ä»¶æ‹·è´è¿‡å»ã€‚<br />
è¿™æ˜¯ä½¿ç”¨æ‹·è´è€Œä¸æ˜¯ç§»åŠ¨ï¼Œæ˜¯å› ä¸ºåœ¨å¾ˆå¤šç³»ç»Ÿä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">/tmp</code>æ–‡ä»¶å¤¹å¾€å¾€æ˜¯å†…å­˜å·ï¼Œè·Ÿç¡¬ç›˜å¹¶ä¸æ˜¯åŒä¸€ä¸ªå­˜å‚¨è®¾å¤‡ï¼Œç›´æ¥ç§»åŠ¨çš„è¯ï¼Œåœ¨æŸäº›ç³»ç»Ÿä¸­å¯èƒ½ä¼šæŠ¥é”™ï¼Œä¹Ÿæ— æ³•çœŸæ­£å°†æ–‡ä»¶ä¿å­˜èµ·æ¥ã€‚</p>

<p>æºç ä»“åº“åœ°å€ï¼š<a href="https://github.com/formoon/rocket-upload">https://github.com/formoon/rocket-upload</a></p>

<p>æœ¬å·¥å…·ç¼–å†™çš„æ—¶å€™ï¼Œå‚è€ƒäº†åŸæœ‰çš„ä¸€ä¸ªrocketæ‰©å±•ï¼š<a href="https://crates.io/crates/rocket-multipart-form-data">https://crates.io/crates/rocket-multipart-form-data</a></p>

:ET