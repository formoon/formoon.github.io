I"É<p><img src="https://raw.githubusercontent.com/formoon/formoon.github.io/master/attachments/201904/tensorFlow2/tf-logo-card-2.png" alt="" /></p>
<h4 id="çº¿æ€§å›å½’æ¨¡å‹">çº¿æ€§å›å½’æ¨¡å‹</h4>
<p>â€œå›å½’â€è¿™ä¸ªè¯ï¼Œæ—¢æ˜¯Regressionç®—æ³•çš„åç§°ï¼Œä¹Ÿä»£è¡¨äº†ä¸åŒçš„è®¡ç®—ç»“æœã€‚å½“ç„¶ç»“æœä¹Ÿæ˜¯ç”±ç®—æ³•å†³å®šçš„ã€‚<br />
ä¸åŒäºå‰é¢è®²è¿‡çš„å¤šä¸ªåˆ†ç±»ç®—æ³•æˆ–è€…é€»è¾‘å›å½’ï¼Œçº¿æ€§å›å½’æ¨¡å‹çš„ç»“æœæ˜¯ä¸€ä¸ªè¿ç»­çš„å€¼ã€‚<br />
å®é™…ä¸Šæˆ‘ä»¬ç¬¬ä¸€ç¯‡çš„æˆ¿ä»·é¢„æµ‹å°±å±äºçº¿æ€§å›å½’ç®—æ³•ï¼Œå¦‚æœæŠŠè¿™ä¸ªæ¨¡å‹ç”¨äºé¢„æµ‹ï¼Œç»“æœæ˜¯ä¸€ä¸ªè¿ç»­å€¼è€Œä¸æ˜¯æœ‰é™çš„åˆ†ç±»ã€‚<br />
ä»ä»£ç ä¸Šè®²ï¼Œé‚£ä¸ªä¾‹å­æ›´å¤šçš„æ˜¯ä¸ºäº†å»¶ç»­ä»TensorFlow 1.xè€Œæ¥çš„è§£é¢˜æ€è·¯ï¼Œæˆ‘ä¸æƒ³åœ¨è¿™ä¸ªç³»åˆ—çš„ç¬¬ä¸€ç¯‡å°±ç»™å¤§å®¶å°è±¡ï¼ŒTensorFlow 2.0æˆä¸ºäº†å®Œå…¨ä¸åŒçš„å¦ä¸€ä¸ªä¸œè¥¿ã€‚åœ¨TensorFlow 2.0ä¸­ï¼Œæœ‰æ›´æ–¹ä¾¿çš„æ–¹æ³•å¯ä»¥è§£å†³ç±»ä¼¼é—®é¢˜ã€‚<br />
çº¿æ€§å›å½’ç®—æ³•åœ¨å¤§å¤šæ•°æœºå™¨å­¦ä¹ è¯¾ç¨‹ä¸­ï¼Œä¹Ÿéƒ½æ˜¯æœ€æ—©ä¼šå­¦ä¹ çš„ç®—æ³•ã€‚æ‰€ä»¥å¯¹è¿™ä¸ªç®—æ³•ï¼Œæˆ‘ä»¬éƒ½ä¸é™Œç”Ÿã€‚<br />
å› æ­¤æœ¬ç¯‡çš„é‡ç‚¹ä¸åœ¨ç®—æ³•æœ¬èº«ï¼Œä¹Ÿä¸åœ¨æ²¹è€—çš„é¢„æµ‹ï¼Œè€Œæ˜¯é€šè¿‡æ²¹è€—é¢„æµ‹è¿™æ ·ç®€å•çš„ä¾‹å­ï¼Œä»‹ç»åœ¨TensorFlow 2.0ä¸­ï¼Œå¦‚ä½•æ›´å¥½çš„å¯¹è®­ç»ƒè¿‡ç¨‹è¿›è¡Œç›‘æ§å’Œç®¡ç†ï¼Œè¿˜æœ‰å…¶å®ƒä¸€äº›æ–¹ä¾¿æœ‰æ•ˆçš„å°æŠ€å·§ã€‚</p>

<h4 id="äº†è§£æ ·æœ¬æ•°æ®">äº†è§£æ ·æœ¬æ•°æ®</h4>
<p>åœ¨æœºå™¨å­¦ä¹ ç®—æ³•æœ¬èº«æ²¡æœ‰å¤§çš„çªç ´çš„æƒ…å†µä¸‹ï¼Œå¯¹æ ·æœ¬æ•°æ®çš„é€‰å–ã€é¢„å¤„ç†å¾€å¾€æ˜¯é¡¹ç›®æˆåŠŸçš„å…³é”®ã€‚æˆ‘ä»¬æ¥ç»­å‰ä¸€ç¯‡ç»§ç»­è¯´ä¸€è¯´æ ·æœ¬æ•°æ®ã€‚<br />
æ ·æœ¬æ•°æ®çš„é¢„å¤„ç†ä¾é å¯¹æ ·æœ¬æ•°æ®çš„äº†è§£å’Œåˆ†æã€‚Pythonçš„äº¤äº’æ¨¡å¼é…åˆç¬¬ä¸‰æ–¹å·¥å…·åŒ…åˆ™æ˜¯å¯¹æ ·æœ¬æ•°æ®åˆ†æçš„å¼ºåŠ›æ­¦å™¨ã€‚<br />
ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨Pythonçš„äº¤äº’æ¨¡å¼ï¼Œè½½å…¥æ²¹è€—é¢„æµ‹çš„æ ·æœ¬æ•°æ®ï¼Œå…ˆç›´è§‚çš„çœ‹ä¸€ä¸‹æ ·æœ¬æ•°æ®ï¼š<br />
ï¼ˆç¬¬ä¸€æ¬¡è½½å…¥æ ·æœ¬æ•°æ®ä¼šä»ç½‘ä¸Šä¸‹è½½ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼‰</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">python3</span>
<span class="n">Python</span> <span class="mf">3.7</span><span class="p">.</span><span class="mi">3</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">09</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">39</span><span class="p">)</span> 
<span class="p">[</span><span class="n">Clang</span> <span class="mf">10.0</span><span class="p">.</span><span class="mi">0</span> <span class="p">(</span><span class="n">clang</span><span class="o">-</span><span class="mf">1000.11</span><span class="p">.</span><span class="mf">45.5</span><span class="p">)]</span> <span class="n">on</span> <span class="n">darwin</span>
<span class="n">Type</span> <span class="s">"help"</span><span class="p">,</span> <span class="s">"copyright"</span><span class="p">,</span> <span class="s">"credits"</span> <span class="ow">or</span> <span class="s">"license"</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="p">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dataset_path</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">get_file</span><span class="p">(</span><span class="s">"auto-mpg.data"</span><span class="p">,</span> <span class="s">"http://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/auto-mpg.data"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'MPG'</span><span class="p">,</span><span class="s">'Cylinders'</span><span class="p">,</span><span class="s">'Displacement'</span><span class="p">,</span><span class="s">'Horsepower'</span><span class="p">,</span><span class="s">'Weight'</span><span class="p">,</span>
<span class="p">...</span>                 <span class="s">'Acceleration'</span><span class="p">,</span> <span class="s">'Model Year'</span><span class="p">,</span> <span class="s">'Origin'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">raw_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">column_names</span><span class="p">,</span>
<span class="p">...</span>                       <span class="n">na_values</span> <span class="o">=</span> <span class="s">"?"</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span>
<span class="p">...</span>                       <span class="n">sep</span><span class="o">=</span><span class="s">" "</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">raw_dataset</span><span class="p">.</span><span class="n">tail</span><span class="p">()</span>
      <span class="n">MPG</span>  <span class="n">Cylinders</span>  <span class="n">Displacement</span>  <span class="n">Horsepower</span>  <span class="n">Weight</span>  <span class="n">Acceleration</span>  <span class="n">Model</span> <span class="n">Year</span>  <span class="n">Origin</span>
<span class="mi">393</span>  <span class="mf">27.0</span>          <span class="mi">4</span>         <span class="mf">140.0</span>        <span class="mf">86.0</span>  <span class="mf">2790.0</span>          <span class="mf">15.6</span>          <span class="mi">82</span>       <span class="mi">1</span>
<span class="mi">394</span>  <span class="mf">44.0</span>          <span class="mi">4</span>          <span class="mf">97.0</span>        <span class="mf">52.0</span>  <span class="mf">2130.0</span>          <span class="mf">24.6</span>          <span class="mi">82</span>       <span class="mi">2</span>
<span class="mi">395</span>  <span class="mf">32.0</span>          <span class="mi">4</span>         <span class="mf">135.0</span>        <span class="mf">84.0</span>  <span class="mf">2295.0</span>          <span class="mf">11.6</span>          <span class="mi">82</span>       <span class="mi">1</span>
<span class="mi">396</span>  <span class="mf">28.0</span>          <span class="mi">4</span>         <span class="mf">120.0</span>        <span class="mf">79.0</span>  <span class="mf">2625.0</span>          <span class="mf">18.6</span>          <span class="mi">82</span>       <span class="mi">1</span>
<span class="mi">397</span>  <span class="mf">31.0</span>          <span class="mi">4</span>         <span class="mf">119.0</span>        <span class="mf">82.0</span>  <span class="mf">2720.0</span>          <span class="mf">19.4</span>          <span class="mi">82</span>       <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">raw_dataset</span>
      <span class="n">MPG</span>  <span class="n">Cylinders</span>  <span class="n">Displacement</span>  <span class="n">Horsepower</span>  <span class="n">Weight</span>  <span class="n">Acceleration</span>  <span class="n">Model</span> <span class="n">Year</span>  <span class="n">Origin</span>
<span class="mi">0</span>    <span class="mf">18.0</span>          <span class="mi">8</span>         <span class="mf">307.0</span>       <span class="mf">130.0</span>  <span class="mf">3504.0</span>          <span class="mf">12.0</span>          <span class="mi">70</span>       <span class="mi">1</span>
<span class="mi">1</span>    <span class="mf">15.0</span>          <span class="mi">8</span>         <span class="mf">350.0</span>       <span class="mf">165.0</span>  <span class="mf">3693.0</span>          <span class="mf">11.5</span>          <span class="mi">70</span>       <span class="mi">1</span>
<span class="mi">2</span>    <span class="mf">18.0</span>          <span class="mi">8</span>         <span class="mf">318.0</span>       <span class="mf">150.0</span>  <span class="mf">3436.0</span>          <span class="mf">11.0</span>          <span class="mi">70</span>       <span class="mi">1</span>
<span class="mi">3</span>    <span class="mf">16.0</span>          <span class="mi">8</span>         <span class="mf">304.0</span>       <span class="mf">150.0</span>  <span class="mf">3433.0</span>          <span class="mf">12.0</span>          <span class="mi">70</span>       <span class="mi">1</span>
<span class="p">..</span>    <span class="p">...</span>        <span class="p">...</span>           <span class="p">...</span>         <span class="p">...</span>     <span class="p">...</span>           <span class="p">...</span>         <span class="p">...</span>     <span class="p">...</span>
<span class="mi">373</span>  <span class="mf">24.0</span>          <span class="mi">4</span>         <span class="mf">140.0</span>        <span class="mf">92.0</span>  <span class="mf">2865.0</span>          <span class="mf">16.4</span>          <span class="mi">82</span>       <span class="mi">1</span>
<span class="mi">374</span>  <span class="mf">23.0</span>          <span class="mi">4</span>         <span class="mf">151.0</span>         <span class="n">NaN</span>  <span class="mf">3035.0</span>          <span class="mf">20.5</span>          <span class="mi">82</span>       <span class="mi">1</span>
<span class="p">..</span>    <span class="p">...</span>        <span class="p">...</span>           <span class="p">...</span>         <span class="p">...</span>     <span class="p">...</span>           <span class="p">...</span>         <span class="p">...</span>     <span class="p">...</span>
<span class="mi">396</span>  <span class="mf">28.0</span>          <span class="mi">4</span>         <span class="mf">120.0</span>        <span class="mf">79.0</span>  <span class="mf">2625.0</span>          <span class="mf">18.6</span>          <span class="mi">82</span>       <span class="mi">1</span>
<span class="mi">397</span>  <span class="mf">31.0</span>          <span class="mi">4</span>         <span class="mf">119.0</span>        <span class="mf">82.0</span>  <span class="mf">2720.0</span>          <span class="mf">19.4</span>          <span class="mi">82</span>       <span class="mi">1</span>

<span class="p">[</span><span class="mi">398</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">8</span> <span class="n">columns</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> 
</code></pre></div></div>
<p>æœ¬ç¯‡å°±ä¸ç”¨è¡¨æ ¼æ¥é€è¡Œè§£é‡Šå±æ€§åˆ—çš„å«ä¹‰äº†ï¼Œæˆ‘ä»¬ä¼šåœ¨ç”¨åˆ°çš„æ¯ä¸€åˆ—å•ç‹¬è¯´æ˜ã€‚<br />
ä½¿ç”¨raw_dataset.tail()åˆ—å‡ºæ•°æ®çš„æœ€åå‡ è¡Œï¼Œæ˜¾ç¤ºæ•°æ®ä¸€å…±åªæœ‰398è¡Œã€‚è¯´æ˜æ•°æ®é›†å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œå¯ä»¥ç›´æ¥å…¨éƒ¨åˆ—å‡ºæ¥ç²—ç•¥çš„çœ‹ä¸€ä¸‹ã€‚è¿™ä¸€æ­¥ä½¿ç”¨Excelä¹‹ç±»çš„å·¥å…·æ•ˆæœå¯èƒ½æ›´å¥½ã€‚ä¸è¿‡ä¹ æƒ¯å‘½ä»¤è¡Œæ“ä½œçš„å·¥ç¨‹å¸ˆç›´æ¥åˆ—å‡ºä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚<br />
æ•°æ®ä¸­å¯ä»¥çœ‹åˆ°ç¬¬374è¡Œï¼Œåœ¨Horsepowerï¼ˆå‘åŠ¨æœºåŠŸç‡ï¼‰ä¸€åˆ—ï¼Œæ„å¤–çš„æœ‰NaNæœªçŸ¥æ•°æ®ã€‚è¿™æ ·çš„æ•°æ®å½“ç„¶æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦é¦–å…ˆè¿›è¡Œæ•°æ®æ¸…æ´—ã€‚å¤§æ•°æ®è½¬è¡Œè¿‡æ¥çš„æŠ€æœ¯äººå‘˜éƒ½ç†Ÿæ‚‰ï¼Œæ•°æ®æ¸…æ´—æ˜¯ä¿è¯æ•°æ®æœ‰æ•ˆæ€§å¿…ä¸å¯å°‘çš„æ‰‹æ®µã€‚<br />
å…¶å®è¿™é‡Œçš„NaNå¹¶ä¸èƒ½å®Œå…¨è¯´æ„å¤–ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨Pandasæ‰“å¼€æ•°æ®é›†çš„æ—¶å€™ä½¿ç”¨äº†å‚æ•°ï¼šna_values = â€œ?â€ï¼Œè¿™æ˜¯æŒ‡æ•°æ®é›†ä¸­å¦‚æœæœ‰â€œï¼Ÿâ€å­—ç¬¦ï¼Œåˆ™æ•°æ®å½“åšæ— æ•ˆæ•°æ®ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨å†…ç½®æ–¹æ³•å¤„ç†ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥æ ¹æ®ä½ è·å–çš„æ•°æ®é›†ä¿®æ”¹ã€‚<br />
æ¯”å¦‚æ£€æŸ¥æ•°æ®é›†æ˜¯å¦æœ‰æ— æ•ˆæ•°æ®å¯ä»¥ä½¿ç”¨isna()æ–¹æ³•ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># ç»§ç»­ä¸Šé¢çš„äº¤äº’æ“ä½œ
</span><span class="p">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">raw_dataset</span><span class="p">.</span><span class="n">isna</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">MPG</span>             <span class="mi">0</span>
<span class="n">Cylinders</span>       <span class="mi">0</span>
<span class="n">Displacement</span>    <span class="mi">0</span>
<span class="n">Horsepower</span>      <span class="mi">6</span>
<span class="n">Weight</span>          <span class="mi">0</span>
<span class="n">Acceleration</span>    <span class="mi">0</span>
<span class="n">Model</span> <span class="n">Year</span>      <span class="mi">0</span>
<span class="n">Origin</span>          <span class="mi">0</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># ç¡®è®¤æœ‰6ä¸ªæ— æ•ˆæ•°æ®ï¼Œéœ€è¦æŠ›å¼ƒç›¸åº”è¡Œ
</span><span class="p">...</span> <span class="c1"># å°†æ•°æ®å¤åˆ¶ä¸€ä»½ï¼Œé˜²æ­¢è¯¯æ“ä½œ
</span><span class="p">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">raw_dataset</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># æŠ›å¼ƒæ— æ•ˆæ•°æ®æ‰€åœ¨è¡Œ
</span><span class="p">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> 
</code></pre></div></div>
<p>æ¥ç€Originä¸€åˆ—ï¼Œå®é™…æ˜¯ä¸€ä¸ªåˆ†ç±»ç±»å‹ï¼Œå¹¶ä¸æ˜¯æ•°å­—ã€‚åˆ†åˆ«ä»£è¡¨è½¦å‹çš„äº§åœ°ä¸ºç¾å›½ã€æ¬§æ´²æˆ–è€…æ—¥æœ¬ã€‚ä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬å·²ç»æœ‰äº†ç»éªŒï¼Œæˆ‘ä»¬è¦æŠŠè¿™ä¸ªæ•°æ®åˆ—è½¬æˆone-hotç¼–ç æ–¹å¼ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># å–å‡ºOriginæ•°æ®åˆ—ï¼ŒåŸæ•°æ®é›†ä¸­å°†ä¸ä¼šå†æœ‰è¿™ä¸€åˆ—
</span><span class="p">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'Origin'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># æ ¹æ®åˆ†ç±»ç¼–ç ï¼Œåˆ†åˆ«ä¸ºæ–°å¯¹åº”åˆ—èµ‹å€¼1.0
</span><span class="p">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span><span class="p">[</span><span class="s">'USA'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">origin</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span><span class="p">[</span><span class="s">'Europe'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">origin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span><span class="p">[</span><span class="s">'Japan'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">origin</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># åˆ—å‡ºæ–°çš„æ•°æ®é›†å°¾éƒ¨ï¼Œä»¥è§‚å¯Ÿç»“æœ
</span><span class="p">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span><span class="p">.</span><span class="n">tail</span><span class="p">()</span>
      <span class="n">MPG</span>  <span class="n">Cylinders</span>  <span class="n">Displacement</span>  <span class="n">Horsepower</span>  <span class="n">Weight</span>  <span class="n">Acceleration</span>  <span class="n">Model</span> <span class="n">Year</span>  <span class="n">USA</span>  <span class="n">Europe</span>  <span class="n">Japan</span>
<span class="mi">393</span>  <span class="mf">27.0</span>          <span class="mi">4</span>         <span class="mf">140.0</span>        <span class="mf">86.0</span>  <span class="mf">2790.0</span>          <span class="mf">15.6</span>          <span class="mi">82</span>  <span class="mf">1.0</span>     <span class="mf">0.0</span>    <span class="mf">0.0</span>
<span class="mi">394</span>  <span class="mf">44.0</span>          <span class="mi">4</span>          <span class="mf">97.0</span>        <span class="mf">52.0</span>  <span class="mf">2130.0</span>          <span class="mf">24.6</span>          <span class="mi">82</span>  <span class="mf">0.0</span>     <span class="mf">1.0</span>    <span class="mf">0.0</span>
<span class="mi">395</span>  <span class="mf">32.0</span>          <span class="mi">4</span>         <span class="mf">135.0</span>        <span class="mf">84.0</span>  <span class="mf">2295.0</span>          <span class="mf">11.6</span>          <span class="mi">82</span>  <span class="mf">1.0</span>     <span class="mf">0.0</span>    <span class="mf">0.0</span>
<span class="mi">396</span>  <span class="mf">28.0</span>          <span class="mi">4</span>         <span class="mf">120.0</span>        <span class="mf">79.0</span>  <span class="mf">2625.0</span>          <span class="mf">18.6</span>          <span class="mi">82</span>  <span class="mf">1.0</span>     <span class="mf">0.0</span>    <span class="mf">0.0</span>
<span class="mi">397</span>  <span class="mf">31.0</span>          <span class="mi">4</span>         <span class="mf">119.0</span>        <span class="mf">82.0</span>  <span class="mf">2720.0</span>          <span class="mf">19.4</span>          <span class="mi">82</span>  <span class="mf">1.0</span>     <span class="mf">0.0</span>    <span class="mf">0.0</span>
<span class="o">&gt;&gt;&gt;</span> 
</code></pre></div></div>
<p>ä¸åŒå‰ä¸€ç¯‡ï¼Œè¿™æ¬¡åšOne-hotç¼–ç çš„æ–¹å¼ç›´æ¥ä½¿ç”¨äº†Pythonè¯­è¨€çš„é€»è¾‘è®¡ç®—è¡¨è¾¾å¼ï¼Œæ•ˆæœä¸€æ ·å¥½ã€‚<br />
å…³äºæ€ä¹ˆçŸ¥é“å“ªä¸ªæ•°å­—ä»£è¡¨å“ªä¸ªäº§åœ°ï¼Œå¦‚æœæ˜¯è‡ªå·±è®¾è®¡çš„æ•°æ®é‡‡é›†æ–¹å¼ï¼Œä½ è‡ªå·±å½“ç„¶åº”å½“çŸ¥é“ã€‚å¦‚æœä½¿ç”¨äº†åˆ«äººçš„æ•°æ®é›†ï¼Œåº”å½“ä»”ç»†é˜…è¯»æ•°æ®çš„è¯´æ˜ã€‚è¿™é‡Œå°±ä¸å¤šè§£é‡Šäº†ã€‚<br />
æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨seabornå·¥å…·ï¼ˆç¬¬ä¸€ç¯‡ä¸­å·²ç»å®‰è£…äº†ï¼‰å¯¹æ•°æ®åšè¿›ä¸€æ­¥åˆ†æï¼ŒseabornåŒ…å«ä¸€ç»„æ•£åˆ—å›¾ç»˜åˆ¶å·¥å…·ï¼Œå¯ä»¥æ›´ç›´è§‚çš„æ­ç¤ºæ•°æ®ä¹‹é—´çš„å…³è”ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># ç»§ç»­ä¸Šé¢çš„äº¤äº’æ“ä½œ
</span><span class="p">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sns</span><span class="p">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">dataset</span><span class="p">[[</span><span class="s">"MPG"</span><span class="p">,</span> <span class="s">"Cylinders"</span><span class="p">,</span> <span class="s">"Displacement"</span><span class="p">,</span> <span class="s">"Weight"</span><span class="p">]],</span> <span class="n">diag_kind</span><span class="o">=</span><span class="s">"kde"</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">seaborn</span><span class="p">.</span><span class="n">axisgrid</span><span class="p">.</span><span class="n">PairGrid</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x139405358</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p><img src="https://raw.githubusercontent.com/formoon/formoon.github.io/master/attachments/201904/tensorFlow2/regression_pairplot.png" alt="" /><br />
ä¸Šå›¾é€‰å–äº†MPG(æ²¹è€—)ã€Cylinders(æ°”ç¼¸æ•°é‡)ã€Displacement(æ’æ°”é‡)ã€Weight(è½¦é‡)å››é¡¹æ•°æ®ï¼Œåšä¸¤ä¸¤å¯¹æ¯”å½¢æˆçš„æ•£ç‚¹å›¾ã€‚<br />
æ•£ç‚¹çŸ©é˜µå›¾ï¼ˆSPLOM:Scatterplot Matrixï¼‰å¯ä»¥ç”¨äºç²—ç•¥æ­ç¤ºæ•°æ®ä¸­ï¼Œä¸åŒåˆ—ä¹‹é—´çš„ç›¸å…³æ€§ã€‚å¯ä»¥ç²—ç•¥ä¼°è®¡å“ªäº›å˜é‡æ˜¯æ­£ç›¸å…³çš„ï¼Œå“ªäº›æ˜¯è´Ÿç›¸å…³çš„ï¼Œè¿›è€Œä¸ºä¸‹ä¸€æ­¥æ•°æ®åˆ†ææä¾›å†³ç­–ã€‚å½“ç„¶è¿™äº›å›¾éœ€è¦è¡Œä¸šä¸“å®¶çš„ç†è§£å’Œåˆ†æã€‚ç„¶åä¸ºç¨‹åºäººå‘˜æä¾›é—´æ¥å¸®åŠ©ã€‚</p>

<h4 id="æ•°æ®è§„èŒƒåŒ–">æ•°æ®è§„èŒƒåŒ–</h4>
<p>ä»åˆšæ‰çš„æ ·æœ¬æ•°æ®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå„åˆ—çš„æ•°æ®ï¼Œå–å€¼èŒƒå›´è¿˜æ˜¯å¾ˆä¸å‡è¡¡çš„ã€‚åœ¨è¿›å…¥æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åšæ•°æ®è§„èŒƒåŒ–ã€‚ä¹Ÿå°±æ˜¯å°†æ‰€æœ‰åˆ—çš„æ•°æ®ç»Ÿä¸€ä¸ºåœ¨åŒä¸€ä¸ªå–å€¼èŒƒå›´çš„æµ®ç‚¹æ•°ã€‚<br />
æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Pandasä¸­å¯¹æ•°æ®çš„ç»Ÿè®¡ç»“æœåšæ•°æ®çš„è§„èŒƒåŒ–ï¼Œè¿™æ ·å¯ä»¥çœå»è‡ªå·±å†™ç¨‹åºåšæ•°æ®ç»Ÿè®¡ã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># ç»§ç»­ä¸Šé¢çš„äº¤äº’æ“ä½œ
</span><span class="p">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">data_stats</span><span class="o">=</span><span class="n">dataset</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data_stats</span>
              <span class="n">MPG</span>   <span class="n">Cylinders</span>  <span class="n">Displacement</span>  <span class="n">Horsepower</span>  <span class="p">...</span>  <span class="n">Model</span> <span class="n">Year</span>         <span class="n">USA</span>      <span class="n">Europe</span>       <span class="n">Japan</span>
<span class="n">count</span>  <span class="mf">392.000000</span>  <span class="mf">392.000000</span>    <span class="mf">392.000000</span>  <span class="mf">392.000000</span>  <span class="p">...</span>  <span class="mf">392.000000</span>  <span class="mf">392.000000</span>  <span class="mf">392.000000</span>  <span class="mf">392.000000</span>
<span class="n">mean</span>    <span class="mf">23.445918</span>    <span class="mf">5.471939</span>    <span class="mf">194.411990</span>  <span class="mf">104.469388</span>  <span class="p">...</span>   <span class="mf">75.979592</span>    <span class="mf">0.625000</span>    <span class="mf">0.173469</span>    <span class="mf">0.201531</span>
<span class="n">std</span>      <span class="mf">7.805007</span>    <span class="mf">1.705783</span>    <span class="mf">104.644004</span>   <span class="mf">38.491160</span>  <span class="p">...</span>    <span class="mf">3.683737</span>    <span class="mf">0.484742</span>    <span class="mf">0.379136</span>    <span class="mf">0.401656</span>
<span class="nb">min</span>      <span class="mf">9.000000</span>    <span class="mf">3.000000</span>     <span class="mf">68.000000</span>   <span class="mf">46.000000</span>  <span class="p">...</span>   <span class="mf">70.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>
<span class="mi">25</span><span class="o">%</span>     <span class="mf">17.000000</span>    <span class="mf">4.000000</span>    <span class="mf">105.000000</span>   <span class="mf">75.000000</span>  <span class="p">...</span>   <span class="mf">73.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>
<span class="mi">50</span><span class="o">%</span>     <span class="mf">22.750000</span>    <span class="mf">4.000000</span>    <span class="mf">151.000000</span>   <span class="mf">93.500000</span>  <span class="p">...</span>   <span class="mf">76.000000</span>    <span class="mf">1.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>
<span class="mi">75</span><span class="o">%</span>     <span class="mf">29.000000</span>    <span class="mf">8.000000</span>    <span class="mf">275.750000</span>  <span class="mf">126.000000</span>  <span class="p">...</span>   <span class="mf">79.000000</span>    <span class="mf">1.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>
<span class="nb">max</span>     <span class="mf">46.600000</span>    <span class="mf">8.000000</span>    <span class="mf">455.000000</span>  <span class="mf">230.000000</span>  <span class="p">...</span>   <span class="mf">82.000000</span>    <span class="mf">1.000000</span>    <span class="mf">1.000000</span>    <span class="mf">1.000000</span>

<span class="p">[</span><span class="mi">8</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">10</span> <span class="n">columns</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> 
</code></pre></div></div>
<p>å¯¹äºæ¯ä¸€åˆ—ï¼ŒPandaséƒ½è¿›è¡Œäº†è®°å½•æ€»æ•°ã€å¹³å‡å€¼ã€æ ‡å‡†å·®ã€æœ€å°å€¼ç­‰ç»Ÿè®¡ã€‚æˆ‘ä»¬åšæ•°æ®è§„èŒƒåŒ–ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›å‚æ•°æ¥è¿›è¡Œã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># ç»§ç»­ä¸Šé¢çš„äº¤äº’æ“ä½œ
</span><span class="p">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">data_stats</span><span class="o">=</span><span class="n">data_stats</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data_stats</span>
              <span class="n">count</span>         <span class="n">mean</span>         <span class="n">std</span>     <span class="nb">min</span>       <span class="mi">25</span><span class="o">%</span>      <span class="mi">50</span><span class="o">%</span>       <span class="mi">75</span><span class="o">%</span>     <span class="nb">max</span>
<span class="n">MPG</span>           <span class="mf">392.0</span>    <span class="mf">23.445918</span>    <span class="mf">7.805007</span>     <span class="mf">9.0</span>    <span class="mf">17.000</span>    <span class="mf">22.75</span>    <span class="mf">29.000</span>    <span class="mf">46.6</span>
<span class="n">Cylinders</span>     <span class="mf">392.0</span>     <span class="mf">5.471939</span>    <span class="mf">1.705783</span>     <span class="mf">3.0</span>     <span class="mf">4.000</span>     <span class="mf">4.00</span>     <span class="mf">8.000</span>     <span class="mf">8.0</span>
<span class="n">Displacement</span>  <span class="mf">392.0</span>   <span class="mf">194.411990</span>  <span class="mf">104.644004</span>    <span class="mf">68.0</span>   <span class="mf">105.000</span>   <span class="mf">151.00</span>   <span class="mf">275.750</span>   <span class="mf">455.0</span>
<span class="n">Horsepower</span>    <span class="mf">392.0</span>   <span class="mf">104.469388</span>   <span class="mf">38.491160</span>    <span class="mf">46.0</span>    <span class="mf">75.000</span>    <span class="mf">93.50</span>   <span class="mf">126.000</span>   <span class="mf">230.0</span>
<span class="n">Weight</span>        <span class="mf">392.0</span>  <span class="mf">2977.584184</span>  <span class="mf">849.402560</span>  <span class="mf">1613.0</span>  <span class="mf">2225.250</span>  <span class="mf">2803.50</span>  <span class="mf">3614.750</span>  <span class="mf">5140.0</span>
<span class="n">Acceleration</span>  <span class="mf">392.0</span>    <span class="mf">15.541327</span>    <span class="mf">2.758864</span>     <span class="mf">8.0</span>    <span class="mf">13.775</span>    <span class="mf">15.50</span>    <span class="mf">17.025</span>    <span class="mf">24.8</span>
<span class="n">Model</span> <span class="n">Year</span>    <span class="mf">392.0</span>    <span class="mf">75.979592</span>    <span class="mf">3.683737</span>    <span class="mf">70.0</span>    <span class="mf">73.000</span>    <span class="mf">76.00</span>    <span class="mf">79.000</span>    <span class="mf">82.0</span>
<span class="n">USA</span>           <span class="mf">392.0</span>     <span class="mf">0.625000</span>    <span class="mf">0.484742</span>     <span class="mf">0.0</span>     <span class="mf">0.000</span>     <span class="mf">1.00</span>     <span class="mf">1.000</span>     <span class="mf">1.0</span>
<span class="n">Europe</span>        <span class="mf">392.0</span>     <span class="mf">0.173469</span>    <span class="mf">0.379136</span>     <span class="mf">0.0</span>     <span class="mf">0.000</span>     <span class="mf">0.00</span>     <span class="mf">0.000</span>     <span class="mf">1.0</span>
<span class="n">Japan</span>         <span class="mf">392.0</span>     <span class="mf">0.201531</span>    <span class="mf">0.401656</span>     <span class="mf">0.0</span>     <span class="mf">0.000</span>     <span class="mf">0.00</span>     <span class="mf">0.000</span>     <span class="mf">1.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">norm_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataset</span> <span class="o">-</span> <span class="n">data_stats</span><span class="p">[</span><span class="s">'mean'</span><span class="p">])</span><span class="o">/</span><span class="n">data_stats</span><span class="p">[</span><span class="s">'std'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">norm_data</span><span class="p">.</span><span class="n">tail</span><span class="p">()</span>
          <span class="n">MPG</span>  <span class="n">Cylinders</span>  <span class="n">Displacement</span>  <span class="n">Horsepower</span>    <span class="n">Weight</span>  <span class="n">Acceleration</span>  <span class="n">Model</span> <span class="n">Year</span>       <span class="n">USA</span>    <span class="n">Europe</span>     <span class="n">Japan</span>
<span class="mi">393</span>  <span class="mf">0.455359</span>  <span class="o">-</span><span class="mf">0.862911</span>     <span class="o">-</span><span class="mf">0.519972</span>   <span class="o">-</span><span class="mf">0.479835</span> <span class="o">-</span><span class="mf">0.220842</span>      <span class="mf">0.021267</span>    <span class="mf">1.634321</span>  <span class="mf">0.773608</span> <span class="o">-</span><span class="mf">0.457538</span> <span class="o">-</span><span class="mf">0.501749</span>
<span class="mi">394</span>  <span class="mf">2.633448</span>  <span class="o">-</span><span class="mf">0.862911</span>     <span class="o">-</span><span class="mf">0.930889</span>   <span class="o">-</span><span class="mf">1.363154</span> <span class="o">-</span><span class="mf">0.997859</span>      <span class="mf">3.283479</span>    <span class="mf">1.634321</span> <span class="o">-</span><span class="mf">1.289347</span>  <span class="mf">2.180035</span> <span class="o">-</span><span class="mf">0.501749</span>
<span class="mi">395</span>  <span class="mf">1.095974</span>  <span class="o">-</span><span class="mf">0.862911</span>     <span class="o">-</span><span class="mf">0.567753</span>   <span class="o">-</span><span class="mf">0.531795</span> <span class="o">-</span><span class="mf">0.803605</span>     <span class="o">-</span><span class="mf">1.428605</span>    <span class="mf">1.634321</span>  <span class="mf">0.773608</span> <span class="o">-</span><span class="mf">0.457538</span> <span class="o">-</span><span class="mf">0.501749</span>
<span class="mi">396</span>  <span class="mf">0.583482</span>  <span class="o">-</span><span class="mf">0.862911</span>     <span class="o">-</span><span class="mf">0.711097</span>   <span class="o">-</span><span class="mf">0.661694</span> <span class="o">-</span><span class="mf">0.415097</span>      <span class="mf">1.108671</span>    <span class="mf">1.634321</span>  <span class="mf">0.773608</span> <span class="o">-</span><span class="mf">0.457538</span> <span class="o">-</span><span class="mf">0.501749</span>
<span class="mi">397</span>  <span class="mf">0.967851</span>  <span class="o">-</span><span class="mf">0.862911</span>     <span class="o">-</span><span class="mf">0.720653</span>   <span class="o">-</span><span class="mf">0.583754</span> <span class="o">-</span><span class="mf">0.303253</span>      <span class="mf">1.398646</span>    <span class="mf">1.634321</span>  <span class="mf">0.773608</span> <span class="o">-</span><span class="mf">0.457538</span> <span class="o">-</span><span class="mf">0.501749</span>
<span class="o">&gt;&gt;&gt;</span> 
</code></pre></div></div>

<h4 id="åˆæ­¥çš„ç¨‹åº">åˆæ­¥çš„ç¨‹åº</h4>
<p>æœ‰äº†ä¸Šé¢è¿™äº›å°è¯•ï¼Œå¼€å§‹ç€æ‰‹ç¼–ç¨‹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ æ­¥å·¥ä½œï¼š</p>
<ul>
  <li>å°†æ ·æœ¬æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸¤éƒ¨åˆ†</li>
  <li>å°†æ•°æ®é›†ä¸­çš„MPG(ç™¾è‹±é‡Œæ²¹è€—æ•°ï¼‰å»æ‰ï¼Œå•ç‹¬å‡ºæ¥ä½œä¸ºæ•°æ®é›†çš„æ ‡æ³¨ç»“æœï¼Œè¾¾æˆç›‘ç£å­¦ä¹ </li>
  <li>æ„å»ºæ¨¡å‹ï¼Œç¼–è¯‘æ¨¡å‹</li>
  <li>ä½¿ç”¨è®­ç»ƒé›†æ•°æ®å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒ</li>
  <li>ä½¿ç”¨æµ‹è¯•é›†æ ·æœ¬è¿›è¡Œæ•°æ®é¢„æµ‹ï¼Œè¯„ä¼°æ¨¡å‹æ•ˆæœ</li>
</ul>

<p>æˆ‘ä»¬ä½¿ç”¨é™„å¸¦æ³¨é‡Šçš„æºç æ¥ä»£æ›¿è®²è§£ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="c1"># å¼•å…¥å„é¡¹æ‰©å±•åº“
</span><span class="kn">import</span> <span class="nn">pathlib</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>

<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">layers</span>

<span class="c1"># ä¸‹è½½æ ·æœ¬æ•°æ®
</span><span class="n">dataset_path</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">get_file</span><span class="p">(</span><span class="s">"auto-mpg.data"</span><span class="p">,</span> <span class="s">"https://archive.ics.uci.edu/ml/machine-learning-databases/auto-mpg/auto-mpg.data"</span><span class="p">)</span>
<span class="c1"># æ ·æœ¬ä¸­æ‰€éœ€è¦çš„åˆ—åç§°
</span><span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'MPG'</span><span class="p">,</span> <span class="s">'Cylinders'</span><span class="p">,</span> <span class="s">'Displacement'</span><span class="p">,</span> <span class="s">'Horsepower'</span><span class="p">,</span> <span class="s">'Weight'</span><span class="p">,</span>
                <span class="s">'Acceleration'</span><span class="p">,</span> <span class="s">'Model Year'</span><span class="p">,</span> <span class="s">'Origin'</span><span class="p">]</span> 
<span class="c1"># ä»æ ·æœ¬æ–‡ä»¶ä¸­è¯»å–æŒ‡å®šåˆ—çš„æ•°æ®
</span><span class="n">raw_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">column_names</span><span class="p">,</span>
                          <span class="n">na_values</span><span class="o">=</span><span class="s">"?"</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span>
                          <span class="n">sep</span><span class="o">=</span><span class="s">" "</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># å¤åˆ¶ä¸€ä»½æ•°æ®åšåç»­æ“ä½œ
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">raw_dataset</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># æ•°æ®æ¸…æ´—ï¼Œå»æ‰æ— æ„ä¹‰çš„æ•°æ®
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># å°†Originæ•°æ®åšone-hotç¼–ç ï¼Œç›¸å½“äºè½¬æ¢æˆ3ä¸ªäº§åœ°å­—æ®µ
</span><span class="n">origin</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'Origin'</span><span class="p">)</span>
<span class="n">dataset</span><span class="p">[</span><span class="s">'USA'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">origin</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span>
<span class="n">dataset</span><span class="p">[</span><span class="s">'Europe'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">origin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span>
<span class="n">dataset</span><span class="p">[</span><span class="s">'Japan'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">origin</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span>

<span class="c1"># éšæœºåˆ†é…80%çš„æ•°æ®ä½œä¸ºè®­ç»ƒé›†
# fracæ˜¯ä¿ç•™80%çš„æ•°æ®
# random_stateç›¸å½“äºéšæœºæ•°çš„ç§å­ï¼Œåœ¨è¿™é‡Œå›ºå®šä¸€ä¸ªå€¼æ˜¯ä¸ºäº†æ¯æ¬¡è¿è¡Œï¼Œéšæœºåˆ†é…å¾—åˆ°çš„æ ·æœ¬é›†æ˜¯ç›¸åŒçš„
</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># è®­ç»ƒé›†çš„æ•°æ®å»é™¤æ‰ï¼Œå‰©ä¸‹çš„æ˜¯20%ï¼Œä½œä¸ºæµ‹è¯•é›†
</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="c1"># è·å–æ•°æ®é›†çš„ç»Ÿè®¡ä¿¡æ¯
</span><span class="n">train_stats</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1"># MPGæ˜¯è®­ç»ƒæ¨¡å‹è¦æ±‚çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯æ ‡æ³¨å­—æ®µï¼Œæ²¡æœ‰æ„ä¹‰ï¼Œä»ç»Ÿè®¡ä¸­å»é™¤
</span><span class="n">train_stats</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">"MPG"</span><span class="p">)</span>
<span class="c1"># å¯¹ç»Ÿè®¡ç»“æœåšè¡Œåˆ—è½¬ç½®ï¼Œæ–¹ä¾¿å°†ç»Ÿè®¡ç»“æœä½œä¸ºä¸‹é¢åšæ•°æ®è§„èŒƒåŒ–çš„å‚æ•°
</span><span class="n">train_stats</span> <span class="o">=</span> <span class="n">train_stats</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span>

<span class="c1"># è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ•°æ®é›†éƒ½å»æ‰MPGåˆ—ï¼Œå•ç‹¬å–å‡ºä½œä¸ºæ ‡æ³¨
</span><span class="n">train_labels</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'MPG'</span><span class="p">)</span>
<span class="n">test_labels</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'MPG'</span><span class="p">)</span>

<span class="c1"># å®šä¹‰ä¸€ä¸ªæ•°æ®è§„èŒƒåŒ–å‡½æ•°å¸®åŠ©ç®€åŒ–æ“ä½œ
</span><span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">train_stats</span><span class="p">[</span><span class="s">'mean'</span><span class="p">])</span> <span class="o">/</span> <span class="n">train_stats</span><span class="p">[</span><span class="s">'std'</span><span class="p">]</span>
<span class="c1"># è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ•°æ®è§„èŒƒåŒ–
</span><span class="n">normed_train_data</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">normed_test_data</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>

<span class="c1"># æ„å»ºå›å½’æ¨¡å‹
</span><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">([</span>
        <span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">.</span><span class="n">keys</span><span class="p">())]),</span>
        <span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
        <span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># å›å½’çš„ä¸»è¦åŒºåˆ«å°±æ˜¯æœ€åä¸éœ€è¦æ¿€æ´»å‡½æ•°ï¼Œä»è€Œä¿è¯æœ€åæ˜¯ä¸€ä¸ªè¿ç»­å€¼
</span>    <span class="p">])</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">optimizers</span><span class="p">.</span><span class="n">RMSprop</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>

    <span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s">'mse'</span><span class="p">,</span>
                  <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                  <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'acc'</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
<span class="c1"># æ˜¾ç¤ºæ„é€ çš„æ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span>
  <span class="n">normed_train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span>
  <span class="n">epochs</span><span class="o">=</span><span class="n">EPOCHS</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨æµ‹è¯•é›†é¢„æµ‹æ•°æ®
</span><span class="n">test_result</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">normed_test_data</span><span class="p">)</span>
<span class="c1"># æ˜¾ç¤ºé¢„æµ‹ç»“æœ
</span><span class="k">print</span><span class="p">(</span><span class="s">'===================</span><span class="se">\n</span><span class="s">test_result:'</span><span class="p">,</span> <span class="n">test_result</span><span class="p">)</span>
</code></pre></div></div>
<p>ä½¿ç”¨çš„æ¨¡å‹éå¸¸ç®€å•ï¼Œè®­ç»ƒå’Œé¢„æµ‹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Œæ— éœ€å†è®²è§£ã€‚æ‰§è¡Œç¨‹åºçš„è¾“å‡ºå¤§è‡´å¦‚ä¸‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./mpg1.py
Model: <span class="s2">"sequential"</span>
_________________________________________________________________
Layer <span class="o">(</span><span class="nb">type</span><span class="o">)</span>                 Output Shape              Param <span class="c">#   </span>
<span class="o">=================================================================</span>
dense <span class="o">(</span>Dense<span class="o">)</span>                <span class="o">(</span>None, 64<span class="o">)</span>                640       
_________________________________________________________________
dense_1 <span class="o">(</span>Dense<span class="o">)</span>              <span class="o">(</span>None, 64<span class="o">)</span>                4160      
_________________________________________________________________
dense_2 <span class="o">(</span>Dense<span class="o">)</span>              <span class="o">(</span>None, 1<span class="o">)</span>                 65        
<span class="o">=================================================================</span>
Total params: 4,865
Trainable params: 4,865
Non-trainable params: 0
_________________________________________________________________
Train on 251 samples, validate on 63 samples
Epoch 1/1000
251/251 <span class="o">[==============================]</span> - 0s 2ms/sample - loss: 582.3197 - acc: 0.0000e+00 - val_loss: 582.2971 - val_acc: 0.0000e+00
Epoch 2/1000
251/251 <span class="o">[==============================]</span> - 0s 67us/sample - loss: 542.1007 - acc: 0.0000e+00 - val_loss: 541.7508 - val_acc: 0.0000e+00
	......
Epoch 1000/1000
251/251 <span class="o">[==============================]</span> - 0s 58us/sample - loss: 2.7232 - acc: 0.0000e+00 - val_loss: 9.4673 - val_acc: 0.0000e+00
<span class="o">===================</span>
test_result: <span class="o">[[</span>16.366997 <span class="o">]</span>
 <span class="o">[</span> 8.665408 <span class="o">]</span>
 <span class="o">[</span> 8.548    <span class="o">]</span>
 <span class="o">[</span>25.14063  <span class="o">]</span>
 <span class="o">[</span>18.678812 <span class="o">]</span>
	......
</code></pre></div></div>
<p>è¾“å‡ºçš„æ•°æ®ä¸­ï¼Œä¸€å¼€å§‹æ˜¯æ‰€ä½¿ç”¨çš„æ¨¡å‹ä¿¡æ¯ï¼Œè¿™æ˜¯model.summary()è¾“å‡ºçš„ç»“æœã€‚å¦‚æœæœ‰æ—¶é—´ï¼Œç¿»ç¿»å‰é¢vgg-19å’Œresnet50ç½‘ç»œçš„æ¨¡å‹ï¼Œä¹Ÿè¯•ç”¨ä¸€ä¸‹ï¼Œä¿è¯ä½ å¾—åˆ°ä¸€ä¸ªæƒŠè®¶çš„ç»“æœ:)<br />
éšåæ˜¯1000æ¬¡è¿­ä»£çš„è®­ç»ƒè¾“å‡ºã€‚æœ€åæ˜¯é¢„æµ‹çš„ç»“æœã€‚<br />
å¦‚æœä½ ç»†å¿ƒçš„è¯ï¼Œå¯èƒ½å·²ç»å‘ç°äº†é—®é¢˜ï¼Œä»ç¬¬ä¸€ä¸ªè®­ç»ƒå‘¨æœŸå¼€å§‹ï¼Œä¸€ç›´åˆ°ç¬¬1000æ¬¡ï¼Œè™½ç„¶æŸå¤±lossåœ¨é™ä½ï¼Œä½†æ­£ç¡®ç‡accä¸€ç›´ä¸º0ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ<br />
å…¶å®çœ‹çœ‹æœ€åçš„é¢„æµ‹ç»“æœå°±çŸ¥é“äº†ã€‚å¯¹äºè¿™ç§è¿ç»­è¾“å‡ºå€¼çš„å›å½’é—®é¢˜ï¼Œç»“æœä¸æ˜¯æœ‰é™çš„åˆ†ç±»ï¼Œè€Œæ˜¯å¾ˆç²¾ç¡®çš„æµ®ç‚¹æ•°ã€‚è¿™æ ·çš„ç»“æœï¼Œåªèƒ½ä¿è¯å¤§ä½“æ¯”ä¾‹ä¸Šï¼ŒåŒæ ‡æ³¨é›†æ˜¯å»åˆçš„ï¼Œä¸å¯èƒ½åšåˆ°ä¸€ä¸€å¯¹åº”çš„ç›¸ç­‰ã€‚è¿™æ˜¯æ‰€æœ‰çš„æ­£ç¡®ç‡ç»“æœä¸º0çš„åŸå› ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ²¡æœ‰è·Ÿå‰é¢çš„ä¾‹å­ä¸€æ ·ï¼Œä½¿ç”¨model.evaluateå¯¹æ¨¡å‹è¿›è¡Œè¯„ä¼°çš„åŸå› ã€‚<br />
ç”±æ­¤å¯è§ï¼Œæˆ‘ä»¬åœ¨æ¨¡å‹ç¼–è¯‘çš„æ—¶å€™é€‰å–è¯„ä»·æŒ‡æ ‡å‚æ•°ä¸ºâ€™accâ€™ï¼ˆæ­£ç¡®ç‡ï¼‰å°±æ˜¯ä¸åˆç†çš„ã€‚æ›¿ä»£çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MAE(Mean Abs Error)å¹³å‡ç»å¯¹è¯¯å·®æˆ–è€…MSE(Mean Square Error)å‡æ–¹æ ¹è¯¯å·®/æ ‡å‡†è¯¯å·®ã€‚<br />
æ­¤å¤–ä½ å¯èƒ½çœ‹åˆ°äº†ï¼Œç¨‹åºæ•°æ®é›†ç®€å•ã€æ¨¡å‹ä¹Ÿç®€å•ï¼Œæ‰€ä»¥è®­ç»ƒé€Ÿåº¦å¾ˆå¿«ã€‚1000æ¬¡çš„è¿­ä»£è®­ç»ƒï¼Œä¿¡æ¯è¾“å‡ºæœ¬èº«å ç”¨çš„æ—¶é—´ç”šè‡³å¤šè¿‡äº†è®­ç»ƒæ‰€éœ€çš„æ—¶é—´ã€‚<br />
model.fit()è®­ç»ƒå‡½æ•°ä¸­å¯ä»¥æŒ‡å®šverbose=0æ¥å±è”½è¾“å‡ºï¼Œä½†å®Œå…¨æ²¡æœ‰è¾“å‡ºä¹Ÿæ˜¯å¾ˆä¸å‹å¥½çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‰é¢ç”¨è¿‡çš„å›è°ƒå‡½æ•°æœºåˆ¶ï¼Œæ¥æ˜¾ç¤ºè‡ªå®šä¹‰çš„è¾“å‡ºå†…å®¹ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªè®­ç»ƒå¾ªç¯ä¸­è¾“å‡ºä¸€ä¸ªâ€œ.â€æ¥æ˜¾ç¤ºè®­ç»ƒçš„è¿›å±•ã€‚<br />
æ¥æ”¹è¿›ä¸€ä¸‹ç¨‹åºï¼Œç”¨ä»¥ä¸‹ç¨‹åºæ®µæ¥æ›¿ä»£ä¸Šé¢ä»£ç ä¸­ï¼Œâ€æ„å»ºå›å½’æ¨¡å‹â€ä¹‹åæ‰€æœ‰çš„å†…å®¹ã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># æ›¿ä»£å‰é¢ä»£ç ä¸­ï¼Œæ„å»ºå›å½’æ¨¡å‹ä»¥ä¸‹å†…å®¹
# æ„å»ºå›å½’æ¨¡å‹
</span><span class="k">def</span> <span class="nf">build_model</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">([</span>
        <span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">.</span><span class="n">keys</span><span class="p">())]),</span>
        <span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">),</span>
        <span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># å›å½’çš„ä¸»è¦åŒºåˆ«å°±æ˜¯æœ€åä¸éœ€è¦æ¿€æ´»å‡½æ•°ï¼Œä»è€Œä¿è¯æœ€åæ˜¯ä¸€ä¸ªè¿ç»­å€¼
</span>    <span class="p">])</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">optimizers</span><span class="p">.</span><span class="n">RMSprop</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>

    <span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s">'mse'</span><span class="p">,</span>
                  <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                  <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'mae'</span><span class="p">,</span> <span class="s">'mse'</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="c1"># è‡ªå®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°kerasçš„å›è°ƒï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ˜¾ç¤ºâ€œ.â€
</span><span class="k">class</span> <span class="nc">PrintDot</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">callbacks</span><span class="p">.</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">on_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">logs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
<span class="c1"># æ˜¾ç¤ºæ„é€ çš„æ¨¡å‹
</span><span class="n">model</span><span class="p">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span>
  <span class="n">normed_train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span>
  <span class="n">epochs</span><span class="o">=</span><span class="n">EPOCHS</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
  <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">PrintDot</span><span class="p">()])</span>

<span class="c1"># ä½¿ç”¨æµ‹è¯•é›†è¯„ä¼°æ¨¡å‹
</span><span class="n">loss</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">mse</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">normed_test_data</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># æ˜¾ç¤ºè¯„ä¼°ç»“æœ
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Testing set Mean Abs Error: {:5.2f} MPG"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">mae</span><span class="p">))</span>
</code></pre></div></div>
<p>å†æ¬¡æ‰§è¡Œï¼Œè¾“å‡ºç»“æœçœ‹èµ·æ¥å¹²å‡€å¤šäº†ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./mpg2.py
Model: <span class="s2">"sequential"</span>
_________________________________________________________________
Layer <span class="o">(</span><span class="nb">type</span><span class="o">)</span>                 Output Shape              Param <span class="c">#   </span>
<span class="o">=================================================================</span>
dense <span class="o">(</span>Dense<span class="o">)</span>                <span class="o">(</span>None, 64<span class="o">)</span>                640       
_________________________________________________________________
dense_1 <span class="o">(</span>Dense<span class="o">)</span>              <span class="o">(</span>None, 64<span class="o">)</span>                4160      
_________________________________________________________________
dense_2 <span class="o">(</span>Dense<span class="o">)</span>              <span class="o">(</span>None, 1<span class="o">)</span>                 65        
<span class="o">=================================================================</span>
Total params: 4,865
Trainable params: 4,865
Non-trainable params: 0
_________________________________________________________________

....................................................................................................
....................................................................................................
....................................................................................................
....................................................................................................
....................................................................................................
....................................................................................................
....................................................................................................
....................................................................................................
....................................................................................................
....................................................................................................
Testing <span class="nb">set </span>Mean Abs Error:  1.98 MPG
</code></pre></div></div>
<p>æœ€åæˆ‘ä»¬ä¹Ÿæ•¢ä½¿ç”¨model.evaluateå¯¹æ¨¡å‹è¿›è¡Œè¯„ä¼°äº†ï¼Œå¾—åˆ°çš„MAEæ˜¯1.98ã€‚</p>

<p>ä½†æ˜¯MAEã€MSEçš„æ•°æ®ï¼Œé‡ç‚¹çš„æ˜¯çœ‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„åŠ¨æ€å€¼ï¼Œæ ¹æ®è¶‹åŠ¿è°ƒæ•´æˆ‘ä»¬çš„ç¨‹åºï¼Œæ‰è°ˆå¾—ä¸Šä¼˜åŒ–ã€‚åªæœ‰æœ€ç»ˆä¸€ä¸ªå€¼å…¶å®æ„ä¹‰å¹¶ä¸å¤§ã€‚<br />
æˆ‘ä»¬ç»§ç»­ä¸ºç¨‹åºå¢åŠ åŠŸèƒ½ï¼Œç”¨å›¾å½¢ç»˜åˆ¶å‡ºè®­ç»ƒè¿‡ç¨‹çš„æŒ‡æ ‡å˜åŒ–æƒ…å†µã€‚å‰é¢çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨historyå˜é‡ä¿å­˜äº†è®­ç»ƒè¿‡ç¨‹çš„è¾“å‡ºä¿¡æ¯ï¼Œä¸‹é¢å°±æ˜¯ä½¿ç”¨matplotlibå°†æ•°å€¼ç»˜å‡ºã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># æ¥ç€ä¸Šé¢çš„ä»£ç ï¼Œåœ¨æœ€åæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š  
</span><span class="k">def</span> <span class="nf">plot_history</span><span class="p">(</span><span class="n">history</span><span class="p">):</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="n">history</span><span class="p">)</span>
    <span class="n">hist</span><span class="p">[</span><span class="s">'epoch'</span><span class="p">]</span> <span class="o">=</span> <span class="n">history</span><span class="p">.</span><span class="n">epoch</span>

    <span class="c1"># plt.figure()
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="s">'MAE --- MSE'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Epoch'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Mean Abs Error [MPG]'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">hist</span><span class="p">[</span><span class="s">'epoch'</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s">'mae'</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="s">'Train Error'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">hist</span><span class="p">[</span><span class="s">'epoch'</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s">'val_mae'</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="s">'Val Error'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Epoch'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Mean Square Error [$MPG^2$]'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">hist</span><span class="p">[</span><span class="s">'epoch'</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s">'mse'</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="s">'Train Error'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">hist</span><span class="p">[</span><span class="s">'epoch'</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s">'val_mse'</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="s">'Val Error'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_history</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</code></pre></div></div>
<p>æ‰§è¡Œç¨‹åºï¼Œå¯ä»¥å¾—åˆ°ä¸‹å›¾çš„ç»“æœï¼š<br />
<img src="https://raw.githubusercontent.com/formoon/formoon.github.io/master/attachments/201904/tensorFlow2/regression_mae_mse.png" alt="" />
ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶éšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ ï¼Œè®­ç»ƒé”™è¯¯ç‡åœ¨é™ä½ï¼Œä½†å¤§è‡´ä»100æ¬¡è¿­ä»£ä¹‹åï¼ŒéªŒè¯çš„é”™è¯¯ç‡å°±åŸºæœ¬ç¨³å®šä¸å˜äº†ã€‚é™äºæ ·æœ¬é›†æ•°é‡åŠç»´åº¦é€‰å–ã€æ¨¡å‹è®¾è®¡ç­‰æ–¹é¢çš„åŸå› ï¼Œå¯¹è¿™ä¸ªç»“æœçš„æ»¡æ„åº¦å…ˆæ”¾åœ¨ä¸€è¾¹ã€‚è¿™ä¸ªæ¨¡å‹åœ¨100æ¬¡è¿­ä»£ä¹‹åå°±é•¿æ—¶é—´æ— æ•ˆçš„è®­ç»ƒæ˜¾ç„¶æ˜¯ä¸€ä¸ªå¯ä¼˜åŒ–çš„ç‚¹ã€‚<br />
TensorFlow/Kerasæä¾›äº†EarlyStoppingæœºåˆ¶æ¥åº”å¯¹è¿™ç§é—®é¢˜ï¼ŒEarlyStoppingä¹Ÿæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯·çœ‹æˆ‘ä»¬å®ç°çš„ä»£ç ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°å‰é¢ä»£ç çš„æœ€å
# è®¾ç½®EarlyStoppingå›è°ƒå‡½æ•°ï¼Œç›‘æ§val_lossæŒ‡æ ‡
# å½“è¯¥æŒ‡æ ‡åœ¨10æ¬¡è¿­ä»£ä¸­å‡ä¸å˜åŒ–åé€€å‡º
</span><span class="n">early_stop</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">callbacks</span><span class="p">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s">'val_loss'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># å†æ¬¡è®­ç»ƒæ¨¡å‹
</span><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">normed_train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">EPOCHS</span><span class="p">,</span>
                    <span class="n">validation_split</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stop</span><span class="p">,</span> <span class="n">PrintDot</span><span class="p">()])</span>
<span class="c1"># ç»˜åˆ¶æœ¬æ¬¡è®­ç»ƒçš„æŒ‡æ ‡æ›²çº¿
</span><span class="n">plot_history</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</code></pre></div></div>
<p>æ‰§è¡Œåï¼Œè¿™æ¬¡å¾—åˆ°çš„ç»“æœä»¤äººæ»¡æ„äº†ï¼Œå¤§è‡´åœ¨60æ¬¡è¿­ä»£ä¹‹åï¼Œå°±å¾—åˆ°äº†åŒå‰é¢1000æ¬¡è¿­ä»£åŸºæœ¬ç›¸ä¼¼çš„ç»“æœï¼š<br />
<img src="https://raw.githubusercontent.com/formoon/formoon.github.io/master/attachments/201904/tensorFlow2/regression_mae_mse2.png" alt="" />
æ—¢ç„¶è®­ç»ƒå®Œæˆï¼Œè™½ç„¶æˆ‘ä»¬ä½¿ç”¨æ¨¡å‹é¢„æµ‹çš„ç»“æœæ— æ³•è·ŸåŸæ ‡æ³¨ä¸€å¯¹ä¸€æ¯”è¾ƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å›¾å½¢çš„æ–¹å¼æ¥æ¯”è¾ƒä¸€ä¸‹ä¸¤ç»„å€¼ï¼Œå¹¶åšä¸€ä¸‹é¢„æµ‹é”™è¯¯ç»Ÿè®¡ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ç»§ç»­åœ¨æœ€åå¢åŠ å¦‚ä¸‹ä»£ç 
# ä½¿ç”¨æµ‹è¯•é›†æ•°æ®ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹
</span><span class="n">test_predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">normed_test_data</span><span class="p">).</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># ç»˜åˆ¶åŒæ ‡æ³¨çš„å¯¹æ¯”å›¾å’Œä¸¤è€…è¯¯å·®åˆ†å¸ƒçš„ç›´æ–¹å›¾
</span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="s">'Prediction &amp; TrueValues  --- Error'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">test_labels</span><span class="p">,</span> <span class="n">test_predictions</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'True Values [MPG]'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Predictions [MPG]'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'equal'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'square'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">plt</span><span class="p">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">test_predictions</span> <span class="o">-</span> <span class="n">test_labels</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Prediction Error [MPG]"</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Count"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p>ç¨‹åºå¾—åˆ°ç»“æœå›¾å¦‚ä¸‹ï¼š<br />
<img src="https://raw.githubusercontent.com/formoon/formoon.github.io/master/attachments/201904/tensorFlow2/regression_predict_and_error.png" alt="" />
å·¦è¾¹çš„å›¾ä¸­ï¼Œå¦‚æœé¢„æµ‹ç»“æœåŒæ ‡æ³¨ç»“æœå®Œå…¨ä¸€è‡´ï¼Œè“è‰²çš„ç‚¹å°†è½åœ¨ä¸»å¯¹è§’çº¿ä¸Šï¼Œåç¦»å¯¹è§’çº¿åˆ™ä»£è¡¨é¢„æµ‹è¯¯å·®ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„ç‚¹å¤§è‡´æ˜¯è½åœ¨ä¸»å¯¹è§’çº¿å‘¨è¾¹çš„ã€‚è¿™è¡¨ç¤ºé¢„æµ‹ç»“æœåŒæ ‡æ³¨å€¼åŸºæœ¬å»åˆã€‚<br />
å³è¾¹çš„å›¾æ˜¯ä¸¤è€…ä¹‹å·®çš„èŒƒå›´ç»Ÿè®¡ç»“æœï¼Œå¯ä»¥ç†è§£ä¸ºå·¦å›¾é€†æ—¶é’ˆé€†æ—¶é’ˆæ—‹è½¬45åº¦åæ‰€æœ‰ç‚¹ç»Ÿè®¡çš„ç›´æ–¹å›¾ï¼Œå¯¹è§’çº¿å°±æ˜¯è¯¯å·®ä¸º0çš„ä½ç½®ã€‚å›¾ä¸­èƒ½çœ‹å‡ºè¯¯å·®åŸºæœ¬ç¬¦åˆæ­£æ€åˆ†å¸ƒï¼Œä»£è¡¨é¢„æµ‹æ•°å€¼åå¤§ã€åå°çš„æ•°é‡å’Œæ¯”ä¾‹åŸºæœ¬ç›¸ä¼¼ï¼Œæ¨¡å‹æ˜¯å¯ä¿¡çš„ã€‚<br />
å½“ç„¶é™äºæ ·æœ¬æ•°é‡è¿‡å°‘çš„é—®é¢˜ï¼Œæ¨¡å‹çš„ä¼˜åŒ–ä½™åœ°è¿˜æ˜¯å¾ˆå¤§çš„ã€‚</p>

<p>ï¼ˆå¾…ç»­â€¦ï¼‰</p>

:ET